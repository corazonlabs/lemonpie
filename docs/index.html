---

title: lemonade


keywords: fastai
sidebar: home_sidebar

summary: "An open source deep learning library for Electronic Health Record (EHR) data."
description: "An open source deep learning library for Electronic Health Record (EHR) data."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this initial release of the library ..</p>
<ul>
<li>it implements 2 deep learning models (an LSTM and a CNN) based on popular papers </li>
<li>that uses synthetic EHR data, created using the open source <a href="https://github.com/synthetichealth/synthea/wiki">Synthea Patient Generator</a></li>
<li>to predict 4 conditions that are on the <a href="https://www.cdc.gov/chronicdisease/about/costs/index.htm">CDC's list of top chronic diseases</a> that contribute most to healthcare costs</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The end goal is to</p>
<ul>
<li>keep adding more model implementations </li>
<li>keep adding different publicly available datasets </li>
<li>and have a leaderboard to track which models and configurations work best on these datasets</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Installable lib coming soon, for now ..</p>
<ol>
<li>Git clone the repo<ul>
<li><code>https://github.com/corazonlabs/lemonade.git</code></li>
</ul>
</li>
<li>Create a new conda env using the <code>environment.yml</code> file<ul>
<li><code>cd lemonade</code></li>
<li><code>conda env create --name lemonade --file environment.yml</code></li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Read through and then run the following <strong>Quick Start</strong> guides to get a general idea. <ul>
<li>if using the cloned repo, run the noteboooks listed</li>
<li>if using installed lib, just open a jupyter notebook and copy, paste &amp; run cell by cell from the guides</li>
<li><a href="./quick_walkthru.html">Quick Walkthrough</a> - notebook - <code>99_running_exps.ipynb</code></li>
<li><a href="./running_exps.html">Running Experiments</a> - notebook - <code>99_quick_walkthru.ipynb</code></li>
</ul>
</li>
<li>Setup Synthea<ul>
<li>Refer to <a href="./setup.html#Setup-Synthea">condensed instructions</a></li>
<li>Generate different datasets you like - e.g. 1K, 5K, 10K</li>
</ul>
</li>
<li>Run experiments<ul>
<li>Refer to <strong>Detailed Docs</strong> for customizations</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Roadmap">Roadmap<a class="anchor-link" href="#Roadmap"> </a></h2><ul>
<li><strong>A leader-board to track which models and configurations work best on different publicly available datasets</strong>.</li>
</ul>
<ul>
<li><p>Callbacks, Mixed Precision, etc</p>
<ul>
<li>Either upgrade the library to use fastai v2.</li>
<li>Or as a minimum, build functionality for fastai-style callbacks &amp; <a href="https://pytorch.org/docs/stable/amp.html">PyTorch AMP</a>.</li>
</ul>
</li>
<li><p>More models</p>
<ul>
<li>Pick some of the best EHR models out there and implement them.</li>
<li><strong>Ideas are welcome</strong>.</li>
</ul>
</li>
<li>More datasets<ul>
<li>eICU and MIMIC3 possibly.</li>
<li><strong>Ideas are welcome</strong>.</li>
</ul>
</li>
<li>NLP on clinical notes<ul>
<li>Synthea does not have clinical notes, so this can only be done with other datasets.</li>
</ul>
</li>
<li>Predicting different conditions<ul>
<li>Again different datasets will allow this - e.g. hospitalization data (length of stay, in-patient mortality), ER data, etc.</li>
</ul>
</li>
<li>Integraion with Experiment management tools like W&amp;B, Comet, etc,.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Known-Issues-&amp;-Limitations">Known Issues &amp; Limitations<a class="anchor-link" href="#Known-Issues-&amp;-Limitations"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li><code>num_workers &gt; 0</code> not working yet, under investigation<ul>
<li>Workaround - depending upon your GPU capacity, you can load the entire dataset on GPU pre-training with a single switch<ul>
<li>If running manually set <code>lazy_load_gpu=False</code> when creating the data object with <code>EHRData(.... )</code></li>
<li>If running through an Experiment config file, set it in the <code>experiment.yaml</code> file</li>
</ul>
</li>
</ul>
</li>
<li>Test coverage<ul>
<li>Need to write more tests for more comprehensive coverage</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Synthea <a href="https://github.com/synthetichealth/synthea">Synthetic Patient Population Simulator</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Jason Walonoski, Mark Kramer, Joseph Nichols, Andre Quina, Chris Moesel, Dylan Hall, Carlton Duffett, Kudakwashe Dube, Thomas Gallagher, Scott McLachlan, Synthea:An approach, method, and software mechanism for generating synthetic patients and the synthetic electronic health care record, Journal of the American Medical Informatics Association, Volume 25, Issue 3, March 2018, Pages 230â€“238, <a href="https://doi.org/10.1093/jamia/ocx079">https://doi.org/10.1093/jamia/ocx079</a></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>LSTM Model <em>based on</em> this paper - <a href="http://arxiv.org/abs/1801.07860">Scalable and accurate deep learning for electronic health records</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Rajkomar, A., Oren, E., Chen, K. et al. Scalable and accurate deep learning with electronic health records. npj Digital Med 1, 18 (2018). <a href="https://doi.org/10.1038/s41746-018-0029-1">https://doi.org/10.1038/s41746-018-0029-1</a></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>CNN Model <em>based</em> on this paper - <a href="http://arxiv.org/abs/1607.07519">Deepr: A Convolutional Net for Medical Records</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Nguyen, P., Tran, T., Wickramasinghe, N., &amp; Venkatesh, S. (2017). $\mathtt {Deepr}$:A Convolutional Net for Medical Records. IEEE Journal of Biomedical and Health Informatics, 21, 22-30.</p>
</blockquote>

</div>
</div>
</div>
</div>
 

