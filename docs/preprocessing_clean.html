---

title: Clean


keywords: fastai
sidebar: home_sidebar

summary: "Functions to split the raw EHR dataset, clean and save for further processing & vocab creation."
description: "Functions to split the raw EHR dataset, clean and save for further processing & vocab creation."
nb_path: "01_preprocessing_clean.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_preprocessing_clean.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Split">Split<a class="anchor-link" href="#Split"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once dataset is assembled, the folder will look as follows ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATA_STORE</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/home/vinod/.lemonpie/datasets&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PATH_1K</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/home/vinod/.lemonpie/datasets/synthea/1K&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_original&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;patients.csv&#39;,
 &#39;observations.csv&#39;,
 &#39;allergies.csv&#39;,
 &#39;payers.csv&#39;,
 &#39;careplans.csv&#39;,
 &#39;medications.csv&#39;,
 &#39;devices.csv&#39;,
 &#39;organizations.csv&#39;,
 &#39;imaging_studies.csv&#39;,
 &#39;procedures.csv&#39;,
 &#39;payer_transitions.csv&#39;,
 &#39;supplies.csv&#39;,
 &#39;conditions.csv&#39;,
 &#39;providers.csv&#39;,
 &#39;encounters.csv&#39;,
 &#39;immunizations.csv&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_raw_ehrdata" class="doc_header"><code>read_raw_ehrdata</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_raw_ehrdata</code>(<strong><code>path</code></strong>, <strong><code>csv_names</code></strong>=<em><code>['patients', 'observations', 'allergies', 'careplans', 'medications', 'imaging_studies', 'procedures', 'conditions', 'immunizations']</code></em>)</p>
</blockquote>
<p>Read raw EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">read_raw_ehrdata</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_original&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patients</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">allergies</span><span class="p">,</span> <span class="n">careplans</span><span class="p">,</span> <span class="n">medications</span><span class="p">,</span> <span class="n">imaging_studies</span><span class="p">,</span> <span class="n">procedures</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">immunizations</span> <span class="o">=</span> <span class="n">dfs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_patients" class="doc_header"><code>split_patients</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_patients</code>(<strong><code>patients</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>random_state</code></strong>=<em><code>1234</code></em>)</p>
</blockquote>
<p>Split the patients dataframe</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split_patients</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Splits:: train: 0.7, valid: 0.2, test: 0.1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1171, 819, 234, 118)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_ehr_dataset" class="doc_header"><code>split_ehr_dataset</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_ehr_dataset</code>(<strong><code>path</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>random_state</code></strong>=<em><code>1234</code></em>)</p>
</blockquote>
<p>Split EHR dataset into train, valid, test and save</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">split_ehr_dataset</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span> <span class="c1">#will use default values for split percents</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Splits:: train: 0.6, valid: 0.2, test: 0.2
Split patients into:: Train: 702, Valid: 234, Test: 235 -- Total before split: 1171
Saved train data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/train
Saved valid data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/valid
Saved test data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/test
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean">Clean<a class="anchor-link" href="#Clean"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_pts" class="doc_header"><code>cleanup_pts</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_pts</code>(<strong><code>pts</code></strong>, <strong><code>is_train</code></strong>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Clean patients df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>patients</code> data frame looks like this before cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patients</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>BIRTHDATE</th>
      <th>DEATHDATE</th>
      <th>SSN</th>
      <th>DRIVERS</th>
      <th>PASSPORT</th>
      <th>PREFIX</th>
      <th>FIRST</th>
      <th>LAST</th>
      <th>SUFFIX</th>
      <th>...</th>
      <th>BIRTHPLACE</th>
      <th>ADDRESS</th>
      <th>CITY</th>
      <th>STATE</th>
      <th>COUNTY</th>
      <th>ZIP</th>
      <th>LAT</th>
      <th>LON</th>
      <th>HEALTHCARE_EXPENSES</th>
      <th>HEALTHCARE_COVERAGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1d604da9-9a81-4ba9-80c2-de3375d59b40</td>
      <td>1989-05-25</td>
      <td>NaN</td>
      <td>999-76-6866</td>
      <td>S99984236</td>
      <td>X19277260X</td>
      <td>Mr.</td>
      <td>José Eduardo181</td>
      <td>Gómez206</td>
      <td>NaN</td>
      <td>...</td>
      <td>Marigot  Saint Andrew Parish  DM</td>
      <td>427 Balistreri Way Unit 19</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>Hampden County</td>
      <td>1013.0</td>
      <td>42.228354</td>
      <td>-72.562951</td>
      <td>271227.08</td>
      <td>1334.88</td>
    </tr>
    <tr>
      <th>1</th>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>1983-11-14</td>
      <td>NaN</td>
      <td>999-73-5361</td>
      <td>S99962402</td>
      <td>X88275464X</td>
      <td>Mr.</td>
      <td>Milo271</td>
      <td>Feil794</td>
      <td>NaN</td>
      <td>...</td>
      <td>Danvers  Massachusetts  US</td>
      <td>422 Farrell Path Unit 69</td>
      <td>Somerville</td>
      <td>Massachusetts</td>
      <td>Middlesex County</td>
      <td>2143.0</td>
      <td>42.360697</td>
      <td>-71.126531</td>
      <td>793946.01</td>
      <td>3204.49</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>1992-06-02</td>
      <td>NaN</td>
      <td>999-27-3385</td>
      <td>S99972682</td>
      <td>X73754411X</td>
      <td>Mr.</td>
      <td>Jayson808</td>
      <td>Fadel536</td>
      <td>NaN</td>
      <td>...</td>
      <td>Springfield  Massachusetts  US</td>
      <td>1056 Harris Lane Suite 70</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>Hampden County</td>
      <td>1020.0</td>
      <td>42.181642</td>
      <td>-72.608842</td>
      <td>574111.90</td>
      <td>2606.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>1978-05-27</td>
      <td>NaN</td>
      <td>999-85-4926</td>
      <td>S99974448</td>
      <td>X40915583X</td>
      <td>Mrs.</td>
      <td>Mariana775</td>
      <td>Rutherford999</td>
      <td>NaN</td>
      <td>...</td>
      <td>Yarmouth  Massachusetts  US</td>
      <td>999 Kuhn Forge</td>
      <td>Lowell</td>
      <td>Massachusetts</td>
      <td>Middlesex County</td>
      <td>1851.0</td>
      <td>42.636143</td>
      <td>-71.343255</td>
      <td>935630.30</td>
      <td>8756.19</td>
    </tr>
    <tr>
      <th>4</th>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>1996-10-18</td>
      <td>NaN</td>
      <td>999-60-7372</td>
      <td>S99915787</td>
      <td>X86772962X</td>
      <td>Mr.</td>
      <td>Gregorio366</td>
      <td>Auer97</td>
      <td>NaN</td>
      <td>...</td>
      <td>Patras  Achaea  GR</td>
      <td>1050 Lindgren Extension Apt 38</td>
      <td>Boston</td>
      <td>Massachusetts</td>
      <td>Suffolk County</td>
      <td>2135.0</td>
      <td>42.352434</td>
      <td>-71.028610</td>
      <td>598763.07</td>
      <td>3772.20</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pt_data</span> <span class="o">=</span> <span class="n">cleanup_pts</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="n">SYNTHEA_DATAGEN_DATES</span><span class="p">[</span><span class="s1">&#39;1K&#39;</span><span class="p">])</span>
<span class="n">patients</span><span class="p">,</span> <span class="n">pt_demo</span><span class="p">,</span> <span class="n">pt_codes</span> <span class="o">=</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our cleanup function produces the following 3 dfs - <code>patients</code>, <code>pt_demographics</code>, <code>pt_codes</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">pt_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1d604da9-9a81-4ba9-80c2-de3375d59b40</th>
      <td>1989-05-25</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>1983-11-14</td>
    </tr>
    <tr>
      <th>10339b10-3cd1-4ac3-ac13-ec26728cb592</th>
      <td>1992-06-02</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>1978-05-27</td>
    </tr>
    <tr>
      <th>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</th>
      <td>1996-10-18</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
      <th>marital</th>
      <th>race</th>
      <th>ethnicity</th>
      <th>gender</th>
      <th>birthplace</th>
      <th>city</th>
      <th>state</th>
      <th>zip</th>
      <th>age_now_days</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1d604da9-9a81-4ba9-80c2-de3375d59b40</th>
      <td>1989-05-25</td>
      <td>M</td>
      <td>white</td>
      <td>hispanic</td>
      <td>M</td>
      <td>Marigot  Saint Andrew Parish  DM</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>1013</td>
      <td>11617</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>1983-11-14</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Danvers  Massachusetts  US</td>
      <td>Somerville</td>
      <td>Massachusetts</td>
      <td>2143</td>
      <td>13636</td>
    </tr>
    <tr>
      <th>10339b10-3cd1-4ac3-ac13-ec26728cb592</th>
      <td>1992-06-02</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Springfield  Massachusetts  US</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>1020</td>
      <td>10513</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>1978-05-27</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>F</td>
      <td>Yarmouth  Massachusetts  US</td>
      <td>Lowell</td>
      <td>Massachusetts</td>
      <td>1851</td>
      <td>15633</td>
    </tr>
    <tr>
      <th>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</th>
      <td>1996-10-18</td>
      <td>xxxnan</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Patras  Achaea  GR</td>
      <td>Boston</td>
      <td>Massachusetts</td>
      <td>2135</td>
      <td>8914</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
      <th>marital</th>
      <th>race</th>
      <th>ethnicity</th>
      <th>gender</th>
      <th>birthplace</th>
      <th>city</th>
      <th>state</th>
      <th>zip</th>
      <th>age_now_days</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1989-05-25</td>
      <td>M</td>
      <td>white</td>
      <td>hispanic</td>
      <td>M</td>
      <td>Marigot  Saint Andrew Parish  DM</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>1013</td>
      <td>11617</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1983-11-14</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Danvers  Massachusetts  US</td>
      <td>Somerville</td>
      <td>Massachusetts</td>
      <td>2143</td>
      <td>13636</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1992-06-02</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Springfield  Massachusetts  US</td>
      <td>Chicopee</td>
      <td>Massachusetts</td>
      <td>1020</td>
      <td>10513</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1978-05-27</td>
      <td>M</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>F</td>
      <td>Yarmouth  Massachusetts  US</td>
      <td>Lowell</td>
      <td>Massachusetts</td>
      <td>1851</td>
      <td>15633</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1996-10-18</td>
      <td>xxxnan</td>
      <td>white</td>
      <td>nonhispanic</td>
      <td>M</td>
      <td>Patras  Achaea  GR</td>
      <td>Boston</td>
      <td>Massachusetts</td>
      <td>2135</td>
      <td>8914</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>The case for keeping a record of the data generation date</strong></p>
<p>Also note the difference in <code>age_now</code> if it were calculated based on default (<code>pd.Timestamp.today()</code>) vs <code>SYNTHEA_DATAGEN_DATES['1K']</code> which is the data generation date for this 1K dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">())</span> <span class="o">-</span> <span class="n">patients</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">SYNTHEA_DATAGEN_DATES</span><span class="p">[</span><span class="s1">&#39;1K&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">patients</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">days</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(10529, 10513)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SYNTHEA_DATAGEN_DATES</span><span class="p">[</span><span class="s1">&#39;1K&#39;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;03-15-2021&#39;, Timestamp(&#39;2021-03-31 14:20:54.088461&#39;))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That is - 1K dataset data generation date is set to March 15th while today is March 31.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pt_codes</span><span class="o">.</span><span class="n">marital</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;M&#39;, &#39;xxxnan&#39;, &#39;S&#39;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_obs" class="doc_header"><code>cleanup_obs</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L93" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_obs</code>(<strong><code>obs</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean observations df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Drops rows with null in the <code>VALUE</code> column</li>
<li>Creates a new <code>code</code> column with a concatenation of <code>code</code>, <code>value</code>, <code>units</code> and <code>type</code><ul>
<li>so that we can use the following logic during vocab creation for observations (further detailed in the vocab documentation)</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>For <code>numeric</code></strong></p>

<pre><code>for 'numeric'
    get unique 'codes'
    for each unique code
        get unique 'units'
            for each unique unit
                bucketize 'values'
                create vocab entry for each 'bucket' -- code||value_bucket||units</code></pre>
<p><strong>For <code>text</code></strong></p>

<pre><code>for 'text'
    get unique 'codes'
    for each unique code
        get unique 'units' #this will be null
            for each unique unit
                get unique 'values'
                create vocab entry for each -- code||value||units</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>'observations' df before cleanup ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">observations</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DATE</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>VALUE</th>
      <th>UNITS</th>
      <th>TYPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>8302-2</td>
      <td>Body Height</td>
      <td>193.3</td>
      <td>cm</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>72514-3</td>
      <td>Pain severity - 0-10 verbal numeric rating [Sc...</td>
      <td>2.0</td>
      <td>{score}</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>29463-7</td>
      <td>Body Weight</td>
      <td>87.8</td>
      <td>kg</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>39156-5</td>
      <td>Body Mass Index</td>
      <td>23.5</td>
      <td>kg/m2</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>8462-4</td>
      <td>Diastolic Blood Pressure</td>
      <td>82.0</td>
      <td>mm[Hg]</td>
      <td>numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_data</span> <span class="o">=</span> <span class="n">cleanup_obs</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>after cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">obs_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>8302-2||193.3||cm||numeric</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>72514-3||2.0||{score}||numeric</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>29463-7||87.8||kg||numeric</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>39156-5||23.5||kg/m2||numeric</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>8462-4||82.0||mm[Hg]||numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>orig_code</th>
      <th>desc</th>
      <th>value</th>
      <th>units</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8302-2</td>
      <td>Body Height</td>
      <td>193.3</td>
      <td>cm</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>1</th>
      <td>72514-3</td>
      <td>Pain severity - 0-10 verbal numeric rating [Sc...</td>
      <td>2.0</td>
      <td>{score}</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29463-7</td>
      <td>Body Weight</td>
      <td>87.8</td>
      <td>kg</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>3</th>
      <td>39156-5</td>
      <td>Body Mass Index</td>
      <td>23.5</td>
      <td>kg/m2</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8462-4</td>
      <td>Diastolic Blood Pressure</td>
      <td>82.0</td>
      <td>mm[Hg]</td>
      <td>numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_algs" class="doc_header"><code>cleanup_algs</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L112" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_algs</code>(<strong><code>allergies</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean allergies df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>allergies</code> have a start and stop date in the same row indicating when an allergy (indicated by its code) started and stopped (or not) for a patient. <br>
So in the cleanup, we flatten that out, meaning create new rows for stop dates. <br>
The dataframe looks as follows before cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">allergies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1982-10-25</td>
      <td>NaN</td>
      <td>76982e06-f8b8-4509-9ca3-65a99c8650fe</td>
      <td>b896bf40-8b72-42b7-b205-142ee3a56b55</td>
      <td>300916003</td>
      <td>Latex allergy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1982-10-25</td>
      <td>NaN</td>
      <td>76982e06-f8b8-4509-9ca3-65a99c8650fe</td>
      <td>b896bf40-8b72-42b7-b205-142ee3a56b55</td>
      <td>300913006</td>
      <td>Shellfish allergy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2002-01-25</td>
      <td>NaN</td>
      <td>71ba0469-f0cc-4177-ac70-ea07cb01c8b8</td>
      <td>7be1a590-4239-4826-9872-031327f3c368</td>
      <td>419474003</td>
      <td>Allergy to mould</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2002-01-25</td>
      <td>NaN</td>
      <td>71ba0469-f0cc-4177-ac70-ea07cb01c8b8</td>
      <td>7be1a590-4239-4826-9872-031327f3c368</td>
      <td>232347008</td>
      <td>Dander (animal) allergy</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2002-01-25</td>
      <td>NaN</td>
      <td>71ba0469-f0cc-4177-ac70-ea07cb01c8b8</td>
      <td>7be1a590-4239-4826-9872-031327f3c368</td>
      <td>418689008</td>
      <td>Allergy to grass pollen</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alg_data</span> <span class="o">=</span> <span class="n">cleanup_algs</span><span class="p">(</span><span class="n">allergies</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Resulting in the following output after cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">alg_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76982e06-f8b8-4509-9ca3-65a99c8650fe</th>
      <td>1982-10-25</td>
      <td>300916003||START</td>
    </tr>
    <tr>
      <th>76982e06-f8b8-4509-9ca3-65a99c8650fe</th>
      <td>1982-10-25</td>
      <td>300913006||START</td>
    </tr>
    <tr>
      <th>71ba0469-f0cc-4177-ac70-ea07cb01c8b8</th>
      <td>2002-01-25</td>
      <td>419474003||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>96942a16-75bc-4026-bd63-e985b0ca1d6d</th>
      <td>2016-09-18</td>
      <td>418689008||STOP</td>
    </tr>
    <tr>
      <th>96942a16-75bc-4026-bd63-e985b0ca1d6d</th>
      <td>2016-09-18</td>
      <td>419263009||STOP</td>
    </tr>
    <tr>
      <th>e6ff4bf9-09c2-4976-aa84-cca142207cf8</th>
      <td>2016-06-25</td>
      <td>300916003||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>300916003||START</td>
      <td>Latex allergy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>300913006||START</td>
      <td>Shellfish allergy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>419474003||START</td>
      <td>Allergy to mould</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>658</th>
      <td>418689008||STOP</td>
      <td>Allergy to grass pollen</td>
    </tr>
    <tr>
      <th>659</th>
      <td>419263009||STOP</td>
      <td>Allergy to tree pollen</td>
    </tr>
    <tr>
      <th>660</th>
      <td>300916003||STOP</td>
      <td>Latex allergy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_crpls" class="doc_header"><code>cleanup_crpls</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L135" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_crpls</code>(<strong><code>careplans</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean careplans df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">careplans</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>REASONCODE</th>
      <th>REASONDESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>d2500b8c-e830-433a-8b9d-368d30741520</td>
      <td>2010-01-23</td>
      <td>2012-01-23</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>d0c40d10-8d87-447e-836e-99d26ad52ea5</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>07d9ddd8-dfa1-4e43-9bfe-39f63f4ace15</td>
      <td>2011-05-13</td>
      <td>2011-08-02</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>e1ab4933-07a1-49f0-b4bd-05500919061d</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a3bb6e99-3b99-44b3-974c-e230b4511b5c</td>
      <td>2011-12-31</td>
      <td>2012-11-30</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>16300c56-a035-4126-a656-68c093da6dfc</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9f5284b7-425a-486a-b36e-ab818c018f2f</td>
      <td>2016-12-29</td>
      <td>2017-01-05</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>3b639086-5fbc-4720-8c31-e8c8c0f1d660</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>47ede16c-c216-4f81-a16b-0e858de9cdc3</td>
      <td>2017-01-22</td>
      <td>2017-02-12</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>4ec8d55b-05fc-42a5-bfa3-1e233874a362</td>
      <td>225358003</td>
      <td>Wound care</td>
      <td>284551006.0</td>
      <td>Laceration of foot</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">crpl_data</span> <span class="o">=</span> <span class="n">cleanup_crpls</span><span class="p">(</span><span class="n">careplans</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">crpl_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2010-01-23</td>
      <td>53950000||START</td>
    </tr>
    <tr>
      <th>10339b10-3cd1-4ac3-ac13-ec26728cb592</th>
      <td>2011-05-13</td>
      <td>53950000||START</td>
    </tr>
    <tr>
      <th>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</th>
      <td>2011-12-31</td>
      <td>53950000||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6d048a56-edb8-4f29-891d-7a84d75a8e78</th>
      <td>2002-11-30</td>
      <td>53950000||STOP</td>
    </tr>
    <tr>
      <th>fca3178e-fb68-41c3-8598-702d3ca68b96</th>
      <td>1983-09-29</td>
      <td>91251008||STOP</td>
    </tr>
    <tr>
      <th>fca3178e-fb68-41c3-8598-702d3ca68b96</th>
      <td>1984-11-22</td>
      <td>385691007||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>53950000||START</td>
      <td>Respiratory therapy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>53950000||START</td>
      <td>Respiratory therapy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>53950000||START</td>
      <td>Respiratory therapy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5431</th>
      <td>53950000||STOP</td>
      <td>Respiratory therapy</td>
    </tr>
    <tr>
      <th>5432</th>
      <td>91251008||STOP</td>
      <td>Physical therapy procedure</td>
    </tr>
    <tr>
      <th>5433</th>
      <td>385691007||STOP</td>
      <td>Fracture care</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_meds" class="doc_header"><code>cleanup_meds</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_meds</code>(<strong><code>medications</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>medications</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">medications</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>PAYER</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>BASE_COST</th>
      <th>PAYER_COVERAGE</th>
      <th>DISPENSES</th>
      <th>TOTALCOST</th>
      <th>REASONCODE</th>
      <th>REASONDESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-05-05T00:26:23Z</td>
      <td>2011-04-30T00:26:23Z</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>b1c428d6-4f07-31e0-90f0-68ffa6ff8c76</td>
      <td>1e0d6b0e-1711-4a25-99f9-b1c700c9b260</td>
      <td>389221</td>
      <td>Etonogestrel 68 MG Drug Implant</td>
      <td>677.08</td>
      <td>0.0</td>
      <td>12</td>
      <td>8124.96</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-04-30T00:26:23Z</td>
      <td>2012-04-24T00:26:23Z</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>b1c428d6-4f07-31e0-90f0-68ffa6ff8c76</td>
      <td>6aa37300-d1b4-48e7-a2f8-5e0f70f48f38</td>
      <td>389221</td>
      <td>Etonogestrel 68 MG Drug Implant</td>
      <td>624.09</td>
      <td>0.0</td>
      <td>12</td>
      <td>7489.08</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012-04-24T00:26:23Z</td>
      <td>2013-04-19T00:26:23Z</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>b1c428d6-4f07-31e0-90f0-68ffa6ff8c76</td>
      <td>7253a9f9-6f6d-429a-926a-7b1d424eae3f</td>
      <td>748856</td>
      <td>Yaz 28 Day Pack</td>
      <td>43.32</td>
      <td>0.0</td>
      <td>12</td>
      <td>519.84</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-05-13T12:58:08Z</td>
      <td>2011-05-27T12:58:08Z</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>d47b3510-2895-3b70-9897-342d681c769d</td>
      <td>e1ab4933-07a1-49f0-b4bd-05500919061d</td>
      <td>313782</td>
      <td>Acetaminophen 325 MG Oral Tablet</td>
      <td>8.14</td>
      <td>0.0</td>
      <td>1</td>
      <td>8.14</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-12-08T15:02:18Z</td>
      <td>2011-12-22T15:02:18Z</td>
      <td>1d604da9-9a81-4ba9-80c2-de3375d59b40</td>
      <td>b1c428d6-4f07-31e0-90f0-68ffa6ff8c76</td>
      <td>792fae81-a007-44b0-8221-46953737b089</td>
      <td>562251</td>
      <td>Amoxicillin 250 MG / Clavulanate 125 MG Oral T...</td>
      <td>11.91</td>
      <td>0.0</td>
      <td>1</td>
      <td>11.91</td>
      <td>444814009.0</td>
      <td>Viral sinusitis (disorder)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_data</span> <span class="o">=</span> <span class="n">cleanup_meds</span><span class="p">(</span><span class="n">medications</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">med_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2010-05-05 00:26:23</td>
      <td>389221||START</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2011-04-30 00:26:23</td>
      <td>389221||START</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2012-04-24 00:26:23</td>
      <td>748856||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6d048a56-edb8-4f29-891d-7a84d75a8e78</th>
      <td>2005-12-31 17:27:52</td>
      <td>2123111||STOP</td>
    </tr>
    <tr>
      <th>fca3178e-fb68-41c3-8598-702d3ca68b96</th>
      <td>1983-09-29 17:27:52</td>
      <td>243670||STOP</td>
    </tr>
    <tr>
      <th>fca3178e-fb68-41c3-8598-702d3ca68b96</th>
      <td>1984-11-22 17:27:52</td>
      <td>313782||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>389221||START</td>
      <td>Etonogestrel 68 MG Drug Implant</td>
    </tr>
    <tr>
      <th>1</th>
      <td>389221||START</td>
      <td>Etonogestrel 68 MG Drug Implant</td>
    </tr>
    <tr>
      <th>2</th>
      <td>748856||START</td>
      <td>Yaz 28 Day Pack</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>84080</th>
      <td>2123111||STOP</td>
      <td>NDA020503 200 ACTUAT Albuterol 0.09 MG/ACTUAT ...</td>
    </tr>
    <tr>
      <th>84081</th>
      <td>243670||STOP</td>
      <td>Aspirin 81 MG Oral Tablet</td>
    </tr>
    <tr>
      <th>84082</th>
      <td>313782||STOP</td>
      <td>Acetaminophen 325 MG Oral Tablet</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_img" class="doc_header"><code>cleanup_img</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L181" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_img</code>(<strong><code>imaging_studies</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>imaging</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imaging_studies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>DATE</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>BODYSITE_CODE</th>
      <th>BODYSITE_DESCRIPTION</th>
      <th>MODALITY_CODE</th>
      <th>MODALITY_DESCRIPTION</th>
      <th>SOP_CODE</th>
      <th>SOP_DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>d3e49b38-7634-4416-879d-7bc68bf3e7df</td>
      <td>2014-07-08T15:35:36Z</td>
      <td>b58731cc-2d8b-4c2d-b327-4cab771af3ef</td>
      <td>3a36836d-da25-4e73-808b-972b669b7e4e</td>
      <td>40983000</td>
      <td>Arm</td>
      <td>DX</td>
      <td>Digital Radiography</td>
      <td>1.2.840.10008.5.1.4.1.1.1.1</td>
      <td>Digital X-Ray Image Storage</td>
    </tr>
    <tr>
      <th>1</th>
      <td>46baf530-4941-40ab-8219-685a08fd9086</td>
      <td>2014-01-22T18:58:37Z</td>
      <td>2ffe9369-24e4-414b-8973-258fad09313a</td>
      <td>33b71e4b-0690-4fe9-897a-dc3b2ff9215c</td>
      <td>40983000</td>
      <td>Arm</td>
      <td>DX</td>
      <td>Digital Radiography</td>
      <td>1.2.840.10008.5.1.4.1.1.1.1</td>
      <td>Digital X-Ray Image Storage</td>
    </tr>
    <tr>
      <th>2</th>
      <td>b8fb8a6e-a2f5-46c9-8b3f-a35aa982efcd</td>
      <td>2001-12-01T02:08:27Z</td>
      <td>86b97fc7-ae8f-4e0d-8e66-db68f36e7a76</td>
      <td>e42d1046-568d-46c2-b0a5-d910b2f3bd1d</td>
      <td>8205005</td>
      <td>Wrist</td>
      <td>DX</td>
      <td>Digital Radiography</td>
      <td>1.2.840.10008.5.1.4.1.1.1.1</td>
      <td>Digital X-Ray Image Storage</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10c8a016-4504-4653-bddf-2dd3610886c8</td>
      <td>2004-07-03T20:46:46Z</td>
      <td>71ba0469-f0cc-4177-ac70-ea07cb01c8b8</td>
      <td>323fca87-817f-4d58-8486-ba92ea739399</td>
      <td>51299004</td>
      <td>Clavicle</td>
      <td>DX</td>
      <td>Digital Radiography</td>
      <td>1.2.840.10008.5.1.4.1.1.1.1</td>
      <td>Digital X-Ray Image Storage</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4221534c-d379-4c6b-a22e-d7eae3fa2609</td>
      <td>2017-02-08T08:42:44Z</td>
      <td>d49f748f-928d-40e8-92c8-73e4c5679711</td>
      <td>cfef48b3-b769-4794-a3e7-f57f7ba8d387</td>
      <td>344001</td>
      <td>Ankle</td>
      <td>DX</td>
      <td>Digital Radiography</td>
      <td>1.2.840.10008.5.1.4.1.1.1.1</td>
      <td>Digital X-Ray Image Storage</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_data</span> <span class="o">=</span> <span class="n">cleanup_img</span><span class="p">(</span><span class="n">imaging_studies</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">img_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b58731cc-2d8b-4c2d-b327-4cab771af3ef</th>
      <td>2014-07-08 15:35:36</td>
      <td>40983000</td>
    </tr>
    <tr>
      <th>2ffe9369-24e4-414b-8973-258fad09313a</th>
      <td>2014-01-22 18:58:37</td>
      <td>40983000</td>
    </tr>
    <tr>
      <th>86b97fc7-ae8f-4e0d-8e66-db68f36e7a76</th>
      <td>2001-12-01 02:08:27</td>
      <td>8205005</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40983000</td>
      <td>Arm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>40983000</td>
      <td>Arm</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8205005</td>
      <td>Wrist</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_procs" class="doc_header"><code>cleanup_procs</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L194" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_procs</code>(<strong><code>procedures</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>procedures</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">procedures</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DATE</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>BASE_COST</th>
      <th>REASONCODE</th>
      <th>REASONDESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-04-30T00:26:23Z</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>6aa37300-d1b4-48e7-a2f8-5e0f70f48f38</td>
      <td>169553002</td>
      <td>Insertion of subcutaneous contraceptive</td>
      <td>14896.56</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-07-27T12:58:08Z</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>dae2b7cb-1316-4b78-954f-fa610a6c6d0e</td>
      <td>430193006</td>
      <td>Medication Reconciliation (procedure)</td>
      <td>726.51</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-11-20T03:04:34Z</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>7ff86631-0378-4bfc-92ce-1edd697eb18e</td>
      <td>430193006</td>
      <td>Medication Reconciliation (procedure)</td>
      <td>788.50</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-02-07T03:04:34Z</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>b8f76eba-7795-4dcd-a544-f27ac2ef3d46</td>
      <td>117015009</td>
      <td>Throat culture (procedure)</td>
      <td>2070.44</td>
      <td>195662009.0</td>
      <td>Acute viral pharyngitis (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-04-19T03:04:34Z</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>640837d9-845a-433c-9fad-47426664a69d</td>
      <td>117015009</td>
      <td>Throat culture (procedure)</td>
      <td>2479.39</td>
      <td>195662009.0</td>
      <td>Acute viral pharyngitis (disorder)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">proc_data</span> <span class="o">=</span> <span class="n">cleanup_procs</span><span class="p">(</span><span class="n">procedures</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">proc_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2011-04-30 00:26:23</td>
      <td>169553002</td>
    </tr>
    <tr>
      <th>10339b10-3cd1-4ac3-ac13-ec26728cb592</th>
      <td>2010-07-27 12:58:08</td>
      <td>430193006</td>
    </tr>
    <tr>
      <th>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</th>
      <td>2010-11-20 03:04:34</td>
      <td>430193006</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>169553002</td>
      <td>Insertion of subcutaneous contraceptive</td>
    </tr>
    <tr>
      <th>1</th>
      <td>430193006</td>
      <td>Medication Reconciliation (procedure)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>430193006</td>
      <td>Medication Reconciliation (procedure)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_cnds" class="doc_header"><code>cleanup_cnds</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_cnds</code>(<strong><code>conditions</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>conditions</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conditions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2001-05-01</td>
      <td>NaN</td>
      <td>1d604da9-9a81-4ba9-80c2-de3375d59b40</td>
      <td>8f104aa7-4ca9-4473-885a-bba2437df588</td>
      <td>40055000</td>
      <td>Chronic sinusitis (disorder)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-08-09</td>
      <td>2011-08-16</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>9d35ec9f-352a-4629-92ef-38eae38437e7</td>
      <td>444814009</td>
      <td>Viral sinusitis (disorder)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-11-16</td>
      <td>2011-11-26</td>
      <td>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</td>
      <td>ae7555a9-eaff-4c09-98a7-21bc6ed1b1fd</td>
      <td>195662009</td>
      <td>Acute viral pharyngitis (disorder)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-05-13</td>
      <td>2011-05-27</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>e1ab4933-07a1-49f0-b4bd-05500919061d</td>
      <td>10509002</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-02-06</td>
      <td>2011-02-14</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>b8f76eba-7795-4dcd-a544-f27ac2ef3d46</td>
      <td>195662009</td>
      <td>Acute viral pharyngitis (disorder)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cnd_data</span> <span class="o">=</span> <span class="n">cleanup_cnds</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">cnd_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1d604da9-9a81-4ba9-80c2-de3375d59b40</th>
      <td>2001-05-01</td>
      <td>40055000||START</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2011-08-09</td>
      <td>444814009||START</td>
    </tr>
    <tr>
      <th>8d4c4326-e9de-4f45-9a4c-f8c36bff89ae</th>
      <td>2011-11-16</td>
      <td>195662009||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fca3178e-fb68-41c3-8598-702d3ca68b96</th>
      <td>1986-03-02</td>
      <td>43878008||STOP</td>
    </tr>
    <tr>
      <th>fc817953-cc8b-45db-9c85-7c0ced8fa90d</th>
      <td>2010-11-25</td>
      <td>444814009||STOP</td>
    </tr>
    <tr>
      <th>fc817953-cc8b-45db-9c85-7c0ced8fa90d</th>
      <td>2012-05-14</td>
      <td>444814009||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40055000||START</td>
      <td>Chronic sinusitis (disorder)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>444814009||START</td>
      <td>Viral sinusitis (disorder)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>195662009||START</td>
      <td>Acute viral pharyngitis (disorder)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12938</th>
      <td>43878008||STOP</td>
      <td>Streptococcal sore throat (disorder)</td>
    </tr>
    <tr>
      <th>12939</th>
      <td>444814009||STOP</td>
      <td>Viral sinusitis (disorder)</td>
    </tr>
    <tr>
      <th>12940</th>
      <td>444814009||STOP</td>
      <td>Viral sinusitis (disorder)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_immns" class="doc_header"><code>cleanup_immns</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L229" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_immns</code>(<strong><code>immunizations</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>immunizations</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">immunizations</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DATE</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>BASE_COST</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-07-27T12:58:08Z</td>
      <td>10339b10-3cd1-4ac3-ac13-ec26728cb592</td>
      <td>dae2b7cb-1316-4b78-954f-fa610a6c6d0e</td>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
      <td>140.52</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-11-20T03:04:34Z</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>7ff86631-0378-4bfc-92ce-1edd697eb18e</td>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
      <td>140.52</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2012-01-23T17:45:28Z</td>
      <td>034e9e3b-2def-4559-bb2a-7850888ae060</td>
      <td>e88bc3a9-007c-405e-aabc-792a38f4aa2b</td>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
      <td>140.52</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-11-26T03:04:34Z</td>
      <td>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</td>
      <td>1923c698-accd-4d70-ba09-e1938f6e96d1</td>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
      <td>140.52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-07-28T15:02:18Z</td>
      <td>1d604da9-9a81-4ba9-80c2-de3375d59b40</td>
      <td>b85c339a-6076-43ed-b9d0-9cf013dec49d</td>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
      <td>140.52</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imm_data</span> <span class="o">=</span> <span class="n">cleanup_immns</span><span class="p">(</span><span class="n">immunizations</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">imm_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10339b10-3cd1-4ac3-ac13-ec26728cb592</th>
      <td>2010-07-27 12:58:08</td>
      <td>140</td>
    </tr>
    <tr>
      <th>f5dcd418-09fe-4a2f-baa0-3da800bd8c3a</th>
      <td>2010-11-20 03:04:34</td>
      <td>140</td>
    </tr>
    <tr>
      <th>034e9e3b-2def-4559-bb2a-7850888ae060</th>
      <td>2012-01-23 17:45:28</td>
      <td>140</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>140</td>
      <td>Influenza  seasonal  injectable  preservative ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Clean-all">Clean all<a class="anchor-link" href="#Clean-all"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_dataset" class="doc_header"><code>cleanup_dataset</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_dataset</code>(<strong><code>path</code></strong>, <strong><code>is_train</code></strong>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Clean all dfs in a split</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_tables</span><span class="p">,</span> <span class="n">code_tables</span> <span class="o">=</span> <span class="n">cleanup_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_split/train&#39;</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">patients</span><span class="p">,</span> <span class="n">pt_demographics</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">allergies</span><span class="p">,</span> \
<span class="n">careplans</span><span class="p">,</span> <span class="n">medications</span><span class="p">,</span> <span class="n">imaging_studies</span><span class="p">,</span> <span class="n">procedures</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">immunizations</span> <span class="o">=</span> <span class="n">data_tables</span>

<span class="n">pt_codes</span><span class="p">,</span> <span class="n">obs_codes</span><span class="p">,</span> <span class="n">alg_codes</span><span class="p">,</span> <span class="n">crpl_codes</span><span class="p">,</span> <span class="n">med_codes</span><span class="p">,</span> <span class="n">img_codes</span><span class="p">,</span> <span class="n">proc_codes</span><span class="p">,</span> <span class="n">cnd_codes</span><span class="p">,</span> <span class="n">imm_codes</span> <span class="o">=</span> <span class="n">code_tables</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conditions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>date    7666
code    7666
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_codes</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>orig_code    173312
desc         173312
value        173312
units        173312
type         173312
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extract-Labels-(y)">Extract Labels (y)<a class="anchor-link" href="#Extract-Labels-(y)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The labels we intend to predict are conditions and must be in the <a href="/lemonpie/basics.html#CONDITIONS"><code>CONDITIONS</code></a> dict</p>
<ul>
<li>Adding them to the <code>patients</code> df</li>
<li>And adding the patient's age when the particular condition was recorded</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CONDITIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s2">&quot;::&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CONDITIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">||START&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>diabetes :: 44054006
stroke :: 230690007
alzheimers :: 26929004
coronary_heart :: 53741008
lung_cancer :: 254637007
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CONDITIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s2">&quot;::&quot;</span><span class="p">,</span><span class="n">CONDITIONS</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>diabetes :: 44054006||START
stroke :: 230690007||START
alzheimers :: 26929004||START
coronary_heart :: 53741008||START
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_ys" class="doc_header"><code>extract_ys</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L263" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_ys</code>(<strong><code>patients</code></strong>, <strong><code>conditions</code></strong>, <strong><code>cnd_dict</code></strong>=<em><code>OrderedDict([('diabetes', '44054006'), ('stroke', '230690007'), ('alzheimers', '26929004'), ('coronary_heart', '53741008'), ('lung_cancer', '254637007')])</code></em>)</p>
</blockquote>
<p>Extract labels from conditions df and add them to patients df with age</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_pts</span> <span class="o">=</span> <span class="n">extract_ys</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">CONDITIONS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_pts</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>birthdate             702
diabetes_y            702
diabetes_age           43
stroke_y              702
stroke_age             30
alzheimers_y          702
alzheimers_age         12
coronary_heart_y      702
coronary_heart_age     39
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Insert-Age">Insert Age<a class="anchor-link" href="#Insert-Age"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Inserting patient's age in months and years into each record df</p>
<ul>
<li>this can be modified to records the patient's age in <strong>days</strong> or even <strong>hours</strong> that might be more relevant for datasets involving hospitalizations or ER admissions </li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_age" class="doc_header"><code>insert_age</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L273" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_age</code>(<strong><code>df</code></strong>, <strong><code>pts_df</code></strong>)</p>
</blockquote>
<p>Insert age in years and months into each of the rec dfs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Do-All-Functions">Do-All Functions<a class="anchor-link" href="#Do-All-Functions"> </a></h2><p>The actual functions that will be called from other modules</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_raw_ehrdata" class="doc_header"><code>clean_raw_ehrdata</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_raw_ehrdata</code>(<strong><code>path</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Split, clean, preprocess &amp; save raw EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_cleaned_ehrdata" class="doc_header"><code>load_cleaned_ehrdata</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L311" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_cleaned_ehrdata</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load cleaned, age-filtered EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_ehr_vocabcodes" class="doc_header"><code>load_ehr_vocabcodes</code><a href="https://github.com/corazonlabs/lemonpie/tree/main/lemonpie/preprocessing/clean.py#L324" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_ehr_vocabcodes</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load codes for vocabs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_raw_ehrdata</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Splits:: train: 0.6, valid: 0.2, test: 0.2
Split patients into:: Train: 702, Valid: 234, Test: 235 -- Total before split: 1171
Saved train data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/train
Saved valid data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/valid
Saved test data to /home/vinod/.lemonpie/datasets/synthea/1K/raw_split/test
Saved cleaned &#34;train&#34; data to /home/vinod/.lemonpie/datasets/synthea/1K/cleaned/train
Saved vocab code tables to /home/vinod/.lemonpie/datasets/synthea/1K/cleaned/train/codes
Saved cleaned &#34;valid&#34; data to /home/vinod/.lemonpie/datasets/synthea/1K/cleaned/valid
Saved cleaned &#34;test&#34; data to /home/vinod/.lemonpie/datasets/synthea/1K/cleaned/test
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_dfs</span><span class="p">,</span> <span class="n">valid_dfs</span><span class="p">,</span> <span class="n">test_dfs</span> <span class="o">=</span> <span class="n">load_cleaned_ehrdata</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
<span class="n">code_dfs</span> <span class="o">=</span> <span class="n">load_ehr_vocabcodes</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     display(df.head())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thispt</span> <span class="o">=</span> <span class="n">train_dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thispt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>patient               b1d50391-79c5-403c-919f-3ded66c9d77a
birthdate                                       1959-09-01
diabetes_y                                           False
diabetes_age                                           NaN
stroke_y                                             False
stroke_age                                             NaN
alzheimers_y                                         False
alzheimers_age                                         NaN
coronary_heart_y                                     False
coronary_heart_age                                     NaN
Name: 0, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;patient&#39;</span><span class="p">],</span> <span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;birthdate&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;b1d50391-79c5-403c-919f-3ded66c9d77a&#39;, &#39;1959-09-01&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;diabetes_y&#39;</span><span class="p">],</span> <span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;stroke_y&#39;</span><span class="p">],</span> <span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;alzheimers_y&#39;</span><span class="p">],</span> <span class="n">thispt</span><span class="p">[</span><span class="s1">&#39;coronary_heart_y&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(False, False, False, False)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     display(df.head())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Making sure condition counts match - before and after split</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CONDITIONS</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;diabetes&#39;: &#39;44054006||START&#39;,
 &#39;stroke&#39;: &#39;230690007||START&#39;,
 &#39;alzheimers&#39;: &#39;26929004||START&#39;,
 &#39;coronary_heart&#39;: &#39;53741008||START&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pts_train</span> <span class="o">=</span> <span class="n">train_dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cnd_train</span><span class="p">,</span> <span class="n">cnd_valid</span><span class="p">,</span> <span class="n">cnd_test</span> <span class="o">=</span> <span class="n">train_dfs</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">valid_dfs</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">test_dfs</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">cnd_train</span><span class="p">[</span><span class="n">cnd_train</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;44054006||START&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>43</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">pts_train</span><span class="p">[</span><span class="n">pts_train</span><span class="p">[</span><span class="s1">&#39;diabetes_y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>43</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

