---

title: preprocessing.clean


keywords: fastai
sidebar: home_sidebar

summary: "Functions to split the raw FHIR dataset, clean and save for further processing & vocab creation."
description: "Functions to split the raw FHIR dataset, clean and save for further processing & vocab creation."
nb_path: "01_preprocessing_clean.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_preprocessing_clean.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Assemble-Data">Assemble Data<a class="anchor-link" href="#Assemble-Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="https://www.cdc.gov/chronicdisease/about/costs/index.htm">Health and Economic Costs of Chronic Diseases - CDC</a></li>
</ul>
<h3 id="Synthea">Synthea<a class="anchor-link" href="#Synthea"> </a></h3><ul>
<li><a href="https://github.com/synthetichealth/synthea/wiki">Synthea - Wiki</a><ul>
<li>contains details about what the project is and how to get started and generate the data.</li>
</ul>
</li>
<li><a href="https://github.com/synthetichealth/synthea/wiki/CSV-File-Data-Dictionary">Synthea Data Dictionary</a></li>
</ul>
<h4 id="Data-Generation">Data Generation<a class="anchor-link" href="#Data-Generation"> </a></h4><ul>
<li>For our purposes, once Synthea is set up, the following scripts generate the data. </li>
<li>Its important to record the run dates, we will use this during preprocessing.</li>
</ul>
<p><code>./run_synthea -s 12345 -p 10000</code></p>
<ul>
<li>run date: 12-19-2019</li>
<li>{alive=10000, dead=1076}</li>
<li>raw - 1.5GB</li>
</ul>
<p><code>./run_synthea -s 54321 -p 20000</code></p>
<ul>
<li>run date: 11-5-2020</li>
<li>{alive=20000, dead=2195}</li>
<li>csv - 2.9GB</li>
</ul>
<p><code>./run_synthea -s 12345 -p 100000</code></p>
<ul>
<li>run date: 4-4-2020</li>
<li>{alive=100000, dead=10872}</li>
<li>csv - 14.6GB</li>
</ul>
<h3 id="Folder-Structure">Folder Structure<a class="anchor-link" href="#Folder-Structure"> </a></h3><ul>
<li>Choose a location to store all Synthea-generated data (<ul>
<li>for example <code>~/mydatastore</code></li>
</ul>
</li>
<li>Copy data generated by Synthea into this specific folder structure <ul>
<li>for 10K data - <code>mydatastore/datasets/synthea/10K/raw_original</code></li>
</ul>
</li>
<li>Then create a symbolic link called <code>datasets</code> in the current working folder pointing to the datasets folder in the datastore <ul>
<li><code>ln -sfn ~/mydatastore/datasets datasets</code></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Split">Split<a class="anchor-link" href="#Split"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once dataset is assembled, the folder will look as follows ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_original&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;patients.csv&#39;,
 &#39;observations.csv&#39;,
 &#39;allergies.csv&#39;,
 &#39;careplans.csv&#39;,
 &#39;medications.csv&#39;,
 &#39;imaging_studies.csv&#39;,
 &#39;procedures.csv&#39;,
 &#39;conditions.csv&#39;,
 &#39;encounters.csv&#39;,
 &#39;immunizations.csv&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_raw_ehrdata" class="doc_header"><code>read_raw_ehrdata</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_raw_ehrdata</code>(<strong><code>path</code></strong>, <strong><code>csv_names</code></strong>=<em><code>['patients', 'observations', 'allergies', 'careplans', 'medications', 'imaging_studies', 'procedures', 'conditions', 'immunizations']</code></em>)</p>
</blockquote>
<p>Read raw EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">read_raw_ehrdata</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_original&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patients</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">allergies</span><span class="p">,</span> <span class="n">careplans</span><span class="p">,</span> <span class="n">medications</span><span class="p">,</span> <span class="n">imaging_studies</span><span class="p">,</span> <span class="n">procedures</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">immunizations</span> <span class="o">=</span> <span class="n">dfs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_patients" class="doc_header"><code>split_patients</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_patients</code>(<strong><code>patients</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>random_state</code></strong>=<em><code>1234</code></em>)</p>
</blockquote>
<p>Split the patients dataframe</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split_patients</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Splits:: train: 0.7, valid: 0.2, test: 0.1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1108, 775, 222, 111)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_ehr_dataset" class="doc_header"><code>split_ehr_dataset</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_ehr_dataset</code>(<strong><code>path</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>random_state</code></strong>=<em><code>1234</code></em>)</p>
</blockquote>
<p>Split EHR dataset into train, valid, test and save</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">split_ehr_dataset</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span> <span class="c1">#will use default values for split percents</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Splits:: train: 0.6, valid: 0.2, test: 0.2
Split patients into:: Train: 664, Valid: 222, Test: 222 -- Total before split: 1108
Saved train data to datasets/synthea/1K/raw_split/train
Saved valid data to datasets/synthea/1K/raw_split/valid
Saved test data to datasets/synthea/1K/raw_split/test
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean">Clean<a class="anchor-link" href="#Clean"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_pts" class="doc_header"><code>cleanup_pts</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L85" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_pts</code>(<strong><code>pts</code></strong>, <strong><code>is_train</code></strong>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Clean patients df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>patients</code> data frame looks like this before cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patients</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>BIRTHDATE</th>
      <th>DEATHDATE</th>
      <th>SSN</th>
      <th>DRIVERS</th>
      <th>PASSPORT</th>
      <th>PREFIX</th>
      <th>FIRST</th>
      <th>LAST</th>
      <th>SUFFIX</th>
      <th>MAIDEN</th>
      <th>MARITAL</th>
      <th>RACE</th>
      <th>ETHNICITY</th>
      <th>GENDER</th>
      <th>BIRTHPLACE</th>
      <th>ADDRESS</th>
      <th>CITY</th>
      <th>STATE</th>
      <th>ZIP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>1990-05-05</td>
      <td>NaN</td>
      <td>999-45-9813</td>
      <td>S99921748</td>
      <td>X74952757X</td>
      <td>Mrs.</td>
      <td>Nanci249</td>
      <td>Hettinger594</td>
      <td>NaN</td>
      <td>Jones311</td>
      <td>M</td>
      <td>white</td>
      <td>english</td>
      <td>F</td>
      <td>Bourne</td>
      <td>540 Nikolaus Meadow</td>
      <td>Billerica</td>
      <td>Massachusetts</td>
      <td>1821.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>92cb2e9a-1a29-450d-8a36-0242cf3c5355</td>
      <td>1983-05-28</td>
      <td>NaN</td>
      <td>999-10-2955</td>
      <td>S99983211</td>
      <td>X67532687X</td>
      <td>Mr.</td>
      <td>Don899</td>
      <td>Mitchell808</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>M</td>
      <td>white</td>
      <td>irish</td>
      <td>M</td>
      <td>Worcester</td>
      <td>512 Pfeffer Byway</td>
      <td>Shutesbury</td>
      <td>Massachusetts</td>
      <td>1072.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>116f1680-4fc0-4b2d-a59e-0e62231efe12</td>
      <td>2011-10-23</td>
      <td>NaN</td>
      <td>999-97-3322</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Belia417</td>
      <td>Zieme486</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>white</td>
      <td>irish</td>
      <td>F</td>
      <td>Braintree Town</td>
      <td>891 Graham Harbor</td>
      <td>Gloucester</td>
      <td>Massachusetts</td>
      <td>1930.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ffc93b3e-3fb3-4a6d-a53d-61de18ef4c23</td>
      <td>1969-02-12</td>
      <td>NaN</td>
      <td>999-28-4068</td>
      <td>S99952230</td>
      <td>X32221027X</td>
      <td>Mr.</td>
      <td>Rhett759</td>
      <td>Mosciski958</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>M</td>
      <td>white</td>
      <td>polish</td>
      <td>M</td>
      <td>Melrose</td>
      <td>609 Eichmann Avenue</td>
      <td>Woburn</td>
      <td>Massachusetts</td>
      <td>1801.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3189d8e4-653a-47c5-a700-941ebf2d02c6</td>
      <td>1969-01-23</td>
      <td>NaN</td>
      <td>999-64-1895</td>
      <td>S99914844</td>
      <td>X20718523X</td>
      <td>Mrs.</td>
      <td>Augustine565</td>
      <td>Rohan584</td>
      <td>NaN</td>
      <td>Cremin516</td>
      <td>M</td>
      <td>white</td>
      <td>american</td>
      <td>F</td>
      <td>Upton</td>
      <td>931 Watsica Lock</td>
      <td>Worcester</td>
      <td>Massachusetts</td>
      <td>1545.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pt_data</span> <span class="o">=</span> <span class="n">cleanup_pts</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="n">SYNTHEA_DATAGEN_DATES</span><span class="p">[</span><span class="s1">&#39;1K&#39;</span><span class="p">])</span>
<span class="n">patients</span><span class="p">,</span> <span class="n">pt_demo</span><span class="p">,</span> <span class="n">pt_codes</span> <span class="o">=</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our cleanup function produces the following 3 dfs - <code>patients</code>, <code>pt_demographics</code>, <code>pt_codes</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">pt_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
    </tr>
    <tr>
      <th>92cb2e9a-1a29-450d-8a36-0242cf3c5355</th>
      <td>1983-05-28</td>
    </tr>
    <tr>
      <th>116f1680-4fc0-4b2d-a59e-0e62231efe12</th>
      <td>2011-10-23</td>
    </tr>
    <tr>
      <th>ffc93b3e-3fb3-4a6d-a53d-61de18ef4c23</th>
      <td>1969-02-12</td>
    </tr>
    <tr>
      <th>3189d8e4-653a-47c5-a700-941ebf2d02c6</th>
      <td>1969-01-23</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
      <th>marital</th>
      <th>race</th>
      <th>ethnicity</th>
      <th>gender</th>
      <th>birthplace</th>
      <th>city</th>
      <th>state</th>
      <th>zip</th>
      <th>age_now_days</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>M</td>
      <td>white</td>
      <td>english</td>
      <td>F</td>
      <td>Bourne</td>
      <td>Billerica</td>
      <td>Massachusetts</td>
      <td>1821</td>
      <td>10422</td>
    </tr>
    <tr>
      <th>92cb2e9a-1a29-450d-8a36-0242cf3c5355</th>
      <td>1983-05-28</td>
      <td>M</td>
      <td>white</td>
      <td>irish</td>
      <td>M</td>
      <td>Worcester</td>
      <td>Shutesbury</td>
      <td>Massachusetts</td>
      <td>1072</td>
      <td>12956</td>
    </tr>
    <tr>
      <th>116f1680-4fc0-4b2d-a59e-0e62231efe12</th>
      <td>2011-10-23</td>
      <td>NaN</td>
      <td>white</td>
      <td>irish</td>
      <td>F</td>
      <td>Braintree Town</td>
      <td>Gloucester</td>
      <td>Massachusetts</td>
      <td>1930</td>
      <td>2581</td>
    </tr>
    <tr>
      <th>ffc93b3e-3fb3-4a6d-a53d-61de18ef4c23</th>
      <td>1969-02-12</td>
      <td>M</td>
      <td>white</td>
      <td>polish</td>
      <td>M</td>
      <td>Melrose</td>
      <td>Woburn</td>
      <td>Massachusetts</td>
      <td>1801</td>
      <td>18174</td>
    </tr>
    <tr>
      <th>3189d8e4-653a-47c5-a700-941ebf2d02c6</th>
      <td>1969-01-23</td>
      <td>M</td>
      <td>white</td>
      <td>american</td>
      <td>F</td>
      <td>Upton</td>
      <td>Worcester</td>
      <td>Massachusetts</td>
      <td>1545</td>
      <td>18194</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>birthdate</th>
      <th>marital</th>
      <th>race</th>
      <th>ethnicity</th>
      <th>gender</th>
      <th>birthplace</th>
      <th>city</th>
      <th>state</th>
      <th>zip</th>
      <th>age_now_days</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1990-05-05</td>
      <td>M</td>
      <td>white</td>
      <td>english</td>
      <td>F</td>
      <td>Bourne</td>
      <td>Billerica</td>
      <td>Massachusetts</td>
      <td>1821</td>
      <td>10422</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1983-05-28</td>
      <td>M</td>
      <td>white</td>
      <td>irish</td>
      <td>M</td>
      <td>Worcester</td>
      <td>Shutesbury</td>
      <td>Massachusetts</td>
      <td>1072</td>
      <td>12956</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-10-23</td>
      <td>NaN</td>
      <td>white</td>
      <td>irish</td>
      <td>F</td>
      <td>Braintree Town</td>
      <td>Gloucester</td>
      <td>Massachusetts</td>
      <td>1930</td>
      <td>2581</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1969-02-12</td>
      <td>M</td>
      <td>white</td>
      <td>polish</td>
      <td>M</td>
      <td>Melrose</td>
      <td>Woburn</td>
      <td>Massachusetts</td>
      <td>1801</td>
      <td>18174</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1969-01-23</td>
      <td>M</td>
      <td>white</td>
      <td>american</td>
      <td>F</td>
      <td>Upton</td>
      <td>Worcester</td>
      <td>Massachusetts</td>
      <td>1545</td>
      <td>18194</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>The case for keeping a record of the data generation date</strong></p>
<p>Also note the difference in <code>age_now</code> if it were calculated based on default (<code>pd.Timestamp.today()</code>) vs <code>SYNTHEA_DATAGEN_DATES['1K']</code> which is the data generation date for this 1K dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">today</span><span class="p">())</span> <span class="o">-</span> <span class="n">patients</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">SYNTHEA_DATAGEN_DATES</span><span class="p">[</span><span class="s1">&#39;1K&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">patients</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">days</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(3407, 2581)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_obs" class="doc_header"><code>cleanup_obs</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L104" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_obs</code>(<strong><code>obs</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean observations df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Drops rows with null in the <code>VALUE</code> column</li>
<li>Creates a new <code>code</code> column with a concatenation of <code>code</code>, <code>value</code>, <code>units</code> and <code>type</code><ul>
<li>so that we can use the following logic during vocab creation for observations (further detailed in the vocab documentation)</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>For <code>numeric</code></strong></p>

<pre><code>for 'numeric'
    get unique 'codes'
    for each unique code
        get unique 'units'
            for each unique unit
                bucketize 'values'
                create vocab entry for each 'bucket' -- code||value_bucket||units</code></pre>
<p><strong>For <code>text</code></strong></p>

<pre><code>for 'text'
    get unique 'codes'
    for each unique code
        get unique 'units' #this will be null
            for each unique unit
                get unique 'values'
                create vocab entry for each -- code||value||units</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>'observations' df before cleanup ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">observations</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DATE</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>VALUE</th>
      <th>UNITS</th>
      <th>TYPE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1990-05-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>62094db5-574e-4102-9488-ca3906ea85ff</td>
      <td>8302-2</td>
      <td>Body Height</td>
      <td>58.3</td>
      <td>cm</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1990-05-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>62094db5-574e-4102-9488-ca3906ea85ff</td>
      <td>72514-3</td>
      <td>Pain severity - 0-10 verbal numeric rating [Sc...</td>
      <td>1.6</td>
      <td>{score}</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990-05-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>62094db5-574e-4102-9488-ca3906ea85ff</td>
      <td>29463-7</td>
      <td>Body Weight</td>
      <td>3.7</td>
      <td>kg</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1990-05-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>62094db5-574e-4102-9488-ca3906ea85ff</td>
      <td>6690-2</td>
      <td>Leukocytes [#/volume] in Blood by Automated count</td>
      <td>7.9</td>
      <td>10*3/uL</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1990-05-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>62094db5-574e-4102-9488-ca3906ea85ff</td>
      <td>789-8</td>
      <td>Erythrocytes [#/volume] in Blood by Automated ...</td>
      <td>4.5</td>
      <td>10*6/uL</td>
      <td>numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_data</span> <span class="o">=</span> <span class="n">cleanup_obs</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">observations</span><span class="p">,</span> <span class="n">obs_codes</span> <span class="o">=</span> <span class="n">obs_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obs_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>after cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">obs_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>8302-2||58.3||cm||numeric</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>72514-3||1.6||{score}||numeric</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>29463-7||3.7||kg||numeric</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>6690-2||7.9||10*3/uL||numeric</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-05-05</td>
      <td>789-8||4.5||10*6/uL||numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>orig_code</th>
      <th>desc</th>
      <th>value</th>
      <th>units</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8302-2</td>
      <td>Body Height</td>
      <td>58.3</td>
      <td>cm</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>1</th>
      <td>72514-3</td>
      <td>Pain severity - 0-10 verbal numeric rating [Sc...</td>
      <td>1.6</td>
      <td>{score}</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29463-7</td>
      <td>Body Weight</td>
      <td>3.7</td>
      <td>kg</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6690-2</td>
      <td>Leukocytes [#/volume] in Blood by Automated count</td>
      <td>7.9</td>
      <td>10*3/uL</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>4</th>
      <td>789-8</td>
      <td>Erythrocytes [#/volume] in Blood by Automated ...</td>
      <td>4.5</td>
      <td>10*6/uL</td>
      <td>numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_algs" class="doc_header"><code>cleanup_algs</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_algs</code>(<strong><code>allergies</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean allergies df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>allergies</code> have a start and stop date in the same row indicating when an allergy (indicated by its code) started and stopped (or not) for a patient. <br>
So in the cleanup, we flatten that out, meaning create new rows for stop dates. <br>
The dataframe looks as follows before cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">allergies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1956-07-24</td>
      <td>NaN</td>
      <td>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</td>
      <td>91aff420-4326-42f2-abbc-bb26a5d8ae83</td>
      <td>419474003</td>
      <td>Allergy to mould</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1956-07-24</td>
      <td>NaN</td>
      <td>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</td>
      <td>91aff420-4326-42f2-abbc-bb26a5d8ae83</td>
      <td>232350006</td>
      <td>House dust mite allergy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1956-07-24</td>
      <td>1973-01-13</td>
      <td>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</td>
      <td>91aff420-4326-42f2-abbc-bb26a5d8ae83</td>
      <td>714035009</td>
      <td>Allergy to soya</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1971-05-13</td>
      <td>NaN</td>
      <td>1cdff491-7e96-4411-acee-d0f080423bb1</td>
      <td>b3b00299-8e7a-4591-ae4a-e097dc6e7073</td>
      <td>424213003</td>
      <td>Allergy to bee venom</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1971-05-13</td>
      <td>NaN</td>
      <td>1cdff491-7e96-4411-acee-d0f080423bb1</td>
      <td>b3b00299-8e7a-4591-ae4a-e097dc6e7073</td>
      <td>419474003</td>
      <td>Allergy to mould</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alg_data</span> <span class="o">=</span> <span class="n">cleanup_algs</span><span class="p">(</span><span class="n">allergies</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">allergies</span><span class="p">,</span> <span class="n">alg_codes</span> <span class="o">=</span> <span class="n">alg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Resulting in the following output after cleanup..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">alg_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</th>
      <td>1956-07-24</td>
      <td>419474003||START</td>
    </tr>
    <tr>
      <th>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</th>
      <td>1956-07-24</td>
      <td>232350006||START</td>
    </tr>
    <tr>
      <th>2a45e46d-b4d0-4959-b07d-fb57b25e9f1d</th>
      <td>1956-07-24</td>
      <td>714035009||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ace46042-749e-44ba-9c7c-92cf42c00eb1</th>
      <td>2013-01-23</td>
      <td>714035009||STOP</td>
    </tr>
    <tr>
      <th>ace46042-749e-44ba-9c7c-92cf42c00eb1</th>
      <td>2013-01-23</td>
      <td>420174000||STOP</td>
    </tr>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>1993-07-10</td>
      <td>419474003||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>419474003||START</td>
      <td>Allergy to mould</td>
    </tr>
    <tr>
      <th>1</th>
      <td>232350006||START</td>
      <td>House dust mite allergy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>714035009||START</td>
      <td>Allergy to soya</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>846</th>
      <td>714035009||STOP</td>
      <td>Allergy to soya</td>
    </tr>
    <tr>
      <th>847</th>
      <td>420174000||STOP</td>
      <td>Allergy to wheat</td>
    </tr>
    <tr>
      <th>848</th>
      <td>419474003||STOP</td>
      <td>Allergy to mould</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_crpls" class="doc_header"><code>cleanup_crpls</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L142" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_crpls</code>(<strong><code>careplans</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean careplans df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">careplans</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>REASONCODE</th>
      <th>REASONDESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>991acfe9-0f58-4a3e-9af6-f5dcc2c8e1af</td>
      <td>2002-12-28</td>
      <td>2003-01-18</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>60717571-4b7b-49f0-8bee-cb99cef3eeeb</td>
      <td>225358003</td>
      <td>Wound care</td>
      <td>283371005.0</td>
      <td>Laceration of forearm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7b021411-19c2-4a72-8f5b-ae8a63e3bb04</td>
      <td>1990-12-19</td>
      <td>1992-01-04</td>
      <td>92cb2e9a-1a29-450d-8a36-0242cf3c5355</td>
      <td>a1363162-be40-40c3-b8a6-ff03892220eb</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>dab0ef53-6e02-4487-9e58-43d6eb847908</td>
      <td>2009-07-18</td>
      <td>NaN</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>a143d31d-ca90-47d3-b3aa-be4443913807</td>
      <td>134435003</td>
      <td>Routine antenatal care</td>
      <td>72892002.0</td>
      <td>Normal pregnancy</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2ec6bac2-eee4-4e1a-bafd-e501b9efe17b</td>
      <td>2010-03-22</td>
      <td>2010-04-05</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>be9f572c-512f-4e62-b9c8-a190b9a5d5f8</td>
      <td>53950000</td>
      <td>Respiratory therapy</td>
      <td>10509002.0</td>
      <td>Acute bronchitis (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>b33af643-ad5d-45a4-81b2-3225cd8335dd</td>
      <td>1997-06-13</td>
      <td>1997-07-11</td>
      <td>92cb2e9a-1a29-450d-8a36-0242cf3c5355</td>
      <td>f5ed9a41-1faa-44f9-9f0b-75666d5244b7</td>
      <td>91251008</td>
      <td>Physical therapy procedure</td>
      <td>44465007.0</td>
      <td>Sprain of ankle</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">crpl_data</span> <span class="o">=</span> <span class="n">cleanup_crpls</span><span class="p">(</span><span class="n">careplans</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">careplans</span><span class="p">,</span> <span class="n">crpl_codes</span> <span class="o">=</span> <span class="n">crpl_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crpl_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">crpl_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>2002-12-28</td>
      <td>225358003||START</td>
    </tr>
    <tr>
      <th>92cb2e9a-1a29-450d-8a36-0242cf3c5355</th>
      <td>1990-12-19</td>
      <td>53950000||START</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>2009-07-18</td>
      <td>134435003||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2003-12-21</td>
      <td>385691007||STOP</td>
    </tr>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2007-02-24</td>
      <td>225358003||STOP</td>
    </tr>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2008-06-07</td>
      <td>53950000||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>225358003||START</td>
      <td>Wound care</td>
    </tr>
    <tr>
      <th>1</th>
      <td>53950000||START</td>
      <td>Respiratory therapy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>134435003||START</td>
      <td>Routine antenatal care</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16585</th>
      <td>385691007||STOP</td>
      <td>Fracture care</td>
    </tr>
    <tr>
      <th>16586</th>
      <td>225358003||STOP</td>
      <td>Wound care</td>
    </tr>
    <tr>
      <th>16587</th>
      <td>53950000||STOP</td>
      <td>Respiratory therapy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_meds" class="doc_header"><code>cleanup_meds</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_meds</code>(<strong><code>medications</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>medications</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">medications</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START</th>
      <th>STOP</th>
      <th>PATIENT</th>
      <th>ENCOUNTER</th>
      <th>CODE</th>
      <th>DESCRIPTION</th>
      <th>COST</th>
      <th>DISPENSES</th>
      <th>TOTALCOST</th>
      <th>REASONCODE</th>
      <th>REASONDESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1990-08-03</td>
      <td>1990-08-17</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>f46ed016-7cf8-4991-81f5-dad3d9f1b33e</td>
      <td>198405</td>
      <td>Ibuprofen 100 MG Oral Tablet</td>
      <td>7.46</td>
      <td>1</td>
      <td>7.46</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1994-08-23</td>
      <td>1994-09-06</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>9307c2e7-c41d-4634-9a8f-9dd317fd2acc</td>
      <td>308182</td>
      <td>Amoxicillin 250 MG Oral Capsule</td>
      <td>7.26</td>
      <td>1</td>
      <td>7.26</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1994-08-23</td>
      <td>1994-09-06</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>9307c2e7-c41d-4634-9a8f-9dd317fd2acc</td>
      <td>198405</td>
      <td>Ibuprofen 100 MG Oral Tablet</td>
      <td>4.40</td>
      <td>1</td>
      <td>4.40</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-02-06</td>
      <td>2000-02-13</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>6906c7bc-cbf2-41bd-a10d-4112248a6bac</td>
      <td>834061</td>
      <td>Penicillin V Potassium 250 MG Oral Tablet</td>
      <td>5.95</td>
      <td>1</td>
      <td>5.95</td>
      <td>43878008.0</td>
      <td>Streptococcal sore throat (disorder)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2002-12-28</td>
      <td>2003-01-18</td>
      <td>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</td>
      <td>60717571-4b7b-49f0-8bee-cb99cef3eeeb</td>
      <td>313782</td>
      <td>Acetaminophen 325 MG Oral Tablet</td>
      <td>5.36</td>
      <td>1</td>
      <td>5.36</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_data</span> <span class="o">=</span> <span class="n">cleanup_meds</span><span class="p">(</span><span class="n">medications</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">medications</span><span class="p">,</span> <span class="n">med_codes</span> <span class="o">=</span> <span class="n">med_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">med_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">med_data</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1990-08-03</td>
      <td>198405||START</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1994-08-23</td>
      <td>308182||START</td>
    </tr>
    <tr>
      <th>d16cfd6a-d9c3-4754-a9f2-e8ce0b7ec40e</th>
      <td>1994-08-23</td>
      <td>198405||START</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>code</th>
    </tr>
    <tr>
      <th>patient</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2006-11-07</td>
      <td>562251||STOP</td>
    </tr>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2007-02-24</td>
      <td>313782||STOP</td>
    </tr>
    <tr>
      <th>6e57d31b-8e6b-4007-8de1-431ae86a0f12</th>
      <td>2007-06-10</td>
      <td>313782||STOP</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>198405||START</td>
      <td>Ibuprofen 100 MG Oral Tablet</td>
    </tr>
    <tr>
      <th>1</th>
      <td>308182||START</td>
      <td>Amoxicillin 250 MG Oral Capsule</td>
    </tr>
    <tr>
      <th>2</th>
      <td>198405||START</td>
      <td>Ibuprofen 100 MG Oral Tablet</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38380</th>
      <td>562251||STOP</td>
      <td>Amoxicillin 250 MG / Clavulanate 125 MG Oral T...</td>
    </tr>
    <tr>
      <th>38381</th>
      <td>313782||STOP</td>
      <td>Acetaminophen 325 MG Oral Tablet</td>
    </tr>
    <tr>
      <th>38382</th>
      <td>313782||STOP</td>
      <td>Acetaminophen 325 MG Oral Tablet</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_img" class="doc_header"><code>cleanup_img</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L183" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_img</code>(<strong><code>imaging_studies</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>imaging</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_procs" class="doc_header"><code>cleanup_procs</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_procs</code>(<strong><code>procedures</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>procedures</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_cnds" class="doc_header"><code>cleanup_cnds</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_cnds</code>(<strong><code>conditions</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>
<p>Clean <code>conditions</code> df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_immns" class="doc_header"><code>cleanup_immns</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L227" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_immns</code>(<strong><code>immunizations</code></strong>, <strong><code>is_train</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Clean-all">Clean all<a class="anchor-link" href="#Clean-all"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cleanup_dataset" class="doc_header"><code>cleanup_dataset</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cleanup_dataset</code>(<strong><code>path</code></strong>, <strong><code>is_train</code></strong>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Clean all dfs in a split</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_tables</span><span class="p">,</span> <span class="n">code_tables</span> <span class="o">=</span> <span class="n">cleanup_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PATH_1K</span><span class="si">}</span><span class="s1">/raw_split/train&#39;</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">patients</span><span class="p">,</span> <span class="n">pt_demographics</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">allergies</span><span class="p">,</span> \
<span class="n">careplans</span><span class="p">,</span> <span class="n">medications</span><span class="p">,</span> <span class="n">imaging_studies</span><span class="p">,</span> <span class="n">procedures</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">immunizations</span> <span class="o">=</span> <span class="n">data_tables</span>

<span class="n">pt_codes</span><span class="p">,</span> <span class="n">obs_codes</span><span class="p">,</span> <span class="n">alg_codes</span><span class="p">,</span> <span class="n">crpl_codes</span><span class="p">,</span> <span class="n">med_codes</span><span class="p">,</span> <span class="n">img_codes</span><span class="p">,</span> <span class="n">proc_codes</span><span class="p">,</span> <span class="n">cnd_codes</span><span class="p">,</span> <span class="n">imm_codes</span> <span class="o">=</span> <span class="n">code_tables</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conditions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>date    26426
code    26426
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_codes</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>orig_code    370128
desc         370128
value        370128
units        370128
type         370128
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extract-Labels-(y)">Extract Labels (y)<a class="anchor-link" href="#Extract-Labels-(y)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The labels we intend to predict are conditions and must be in the <a href="/lemonade/preprocessing_clean.html#CONDITIONS"><code>CONDITIONS</code></a> dict</p>
<ul>
<li>Adding them to the <code>patients</code> df</li>
<li>And adding the patient's age when the particular condition was recorded</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CONDITIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s2">&quot;::&quot;</span><span class="p">,</span><span class="n">CONDITIONS</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>diabetes :: 44054006||START
stroke :: 230690007||START
alzheimers :: 26929004||START
coronary_heart :: 53741008||START
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_ys" class="doc_header"><code>extract_ys</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L259" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_ys</code>(<strong><code>patients</code></strong>, <strong><code>conditions</code></strong>, <strong><code>cnd_dict</code></strong>=<em><code>{'diabetes': '44054006||START', 'stroke': '230690007||START', 'alzheimers': '26929004||START', 'coronary_heart': '53741008||START'}</code></em>)</p>
</blockquote>
<p>Extract labels from conditions df and add them to patients df with age</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_pts</span> <span class="o">=</span> <span class="n">extract_ys</span><span class="p">(</span><span class="n">patients</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">CONDITIONS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_pts</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>birthdate             664
diabetes_y            664
diabetes_age           37
stroke_y              664
stroke_age             42
alzheimers_y          664
alzheimers_age         18
coronary_heart_y      664
coronary_heart_age     34
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Insert-Age">Insert Age<a class="anchor-link" href="#Insert-Age"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Inserting patient's age in months and years into each record df</p>
<ul>
<li>this can be modified to records the patient's age in <strong>days</strong> or even <strong>hours</strong> that might be more relevant for datasets involving hospitalizations or ER admissions </li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="insert_age" class="doc_header"><code>insert_age</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L269" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>insert_age</code>(<strong><code>df</code></strong>, <strong><code>pts_df</code></strong>)</p>
</blockquote>
<p>Insert age in years and months into each of the rec dfs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Do-All-Functions">Do-All Functions<a class="anchor-link" href="#Do-All-Functions"> </a></h2><p>The actual functions that will be called from other modules</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_raw_ehrdata" class="doc_header"><code>clean_raw_ehrdata</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L277" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_raw_ehrdata</code>(<strong><code>path</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>test_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>today</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Split, clean, preprocess &amp; save raw EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_cleaned_ehrdata" class="doc_header"><code>load_cleaned_ehrdata</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L307" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_cleaned_ehrdata</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load cleaned, age-filtered EHR data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_ehr_vocabcodes" class="doc_header"><code>load_ehr_vocabcodes</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/clean.py#L320" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_ehr_vocabcodes</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load codes for vocabs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_dfs</span><span class="p">,</span> <span class="n">valid_dfs</span><span class="p">,</span> <span class="n">test_dfs</span> <span class="o">=</span> <span class="n">load_cleaned_ehrdata</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
<span class="n">code_dfs</span> <span class="o">=</span> <span class="n">load_ehr_vocabcodes</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     display(df.head())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     display(df.head())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

