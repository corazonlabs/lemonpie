---

title: preprocessing.vocab


keywords: fastai
sidebar: home_sidebar



nb_path: "02_preprocessing_vocab.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 02_preprocessing_vocab.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="nn.Embedding-and-nn.EmbeddingBag"><code>nn.Embedding</code> and <code>nn.EmbeddingBag</code><a class="anchor-link" href="#nn.Embedding-and-nn.EmbeddingBag"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>nn.Embedding</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb1</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[-0.8246, -0.4822, -0.9968],
         [-0.3546,  1.2317,  0.9929],
         [ 0.6679, -0.1507, -2.3095],
         [-1.6767, -0.4624, -0.6374],
         [ 0.7486, -1.2633, -0.1052]]], grad_fn=&lt;EmbeddingBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An embedding matrix is a lookup table</p>
<ol>
<li><code>emb1</code> above has 5 rows, that is 5 elements</li>
<li>but looking up an element, returns a vector for that element.</li>
</ol>
<p>Given this embedding matrix, looking up elements 1, 2, 4 will look like this ..</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb1</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[-0.3546,  1.2317,  0.9929],
         [ 0.6679, -0.1507, -2.3095],
         [ 0.7486, -1.2633, -0.1052]]], grad_fn=&lt;EmbeddingBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Batch of inputs is also possible (in this case a batch of 2, each with 3 elements being looked up)</p>
<ul>
<li>Note that inputs (# of elements being looked up) in a batch have to be of the same size</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
<span class="c1"># input = torch.LongTensor([[1,2,4],[0,3,2,1]]) # this will fail</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb1</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[-0.3546,  1.2317,  0.9929],
         [ 0.6679, -0.1507, -2.3095],
         [ 0.7486, -1.2633, -0.1052]],

        [[-0.8246, -0.4822, -0.9968],
         [-1.6767, -0.4624, -0.6374],
         [ 0.6679, -0.1507, -2.3095]]], grad_fn=&lt;EmbeddingBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>nn.EmbeddingBag</code></strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embg1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">EmbeddingBag</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Exactly the same input as in case of <code>nn.Embedding</code> above (batch of 2)</p>
<ul>
<li>but the result will be averaged across the 3 elements in a batch</li>
<li>resulting in an output of 2 vectors not 6 like above</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span> <span class="c1"># exactly same as above, but o/p is avg&#39;d now</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embg1</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.2607, -0.2411, -0.1735],
        [-0.4628,  0.1948,  0.2288]], grad_fn=&lt;EmbeddingBagBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Another way to do this is to send in <code>offsets</code> rather than separating the inputs into 2 (or x number of) lists</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#same as above - 2 of same length 3</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># output will be avg&#39;d by default</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embg1</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.2607, -0.2411, -0.1735],
        [-0.4628,  0.1948,  0.2288]], grad_fn=&lt;EmbeddingBagBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#same as above - batch of 2 inputs, but of length 4 each</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embg1</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span> <span class="c1">#avg&#39;d 2 outputs one for each input batch i.e. avg&#39;d across 4 in each batch</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.3061, -0.6667,  0.0523],
        [-0.3239,  0.3875,  0.5752]], grad_fn=&lt;EmbeddingBagBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Different Sizes</strong></p>
<p>Offsets allow us to have input batches of different lengths</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#same input as above but .. </span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span> <span class="c1">#this indicates - 3 batches of different lengths (0,1,2)(3,4)(5,6,7)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embg1</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.2607, -0.2411, -0.1735],
        [-0.7404, -0.1908, -0.4639],
        [ 0.2092, -0.0039,  1.3196]], grad_fn=&lt;EmbeddingBagBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Application to EHR Data</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Details here</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="itoc,-ctoi,-ctod,-numericalize,-textify"><code>itoc</code>, <code>ctoi</code>, <code>ctod</code>, <code>numericalize</code>, <code>textify</code><a class="anchor-link" href="#itoc,-ctoi,-ctod,-numericalize,-textify"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I tried to extend fastai vocabs, but found it easier to write from scratch</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vocabs">Vocabs<a class="anchor-link" href="#Vocabs"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_dfs</span> <span class="o">=</span> <span class="n">load_ehr_vocabcodes</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pt_codes</span><span class="p">,</span> <span class="n">obs_codes</span><span class="p">,</span> <span class="n">alg_codes</span><span class="p">,</span> <span class="n">crpl_codes</span><span class="p">,</span> <span class="n">med_codes</span><span class="p">,</span> <span class="n">img_codes</span><span class="p">,</span> <span class="n">proc_codes</span><span class="p">,</span> <span class="n">cnd_codes</span><span class="p">,</span> <span class="n">immn_codes</span> <span class="o">=</span> <span class="n">code_dfs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EhrVocab" class="doc_header"><code>class</code> <code>EhrVocab</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EhrVocab</code>(<strong><code>itoc</code></strong>, <strong><code>ctoi</code></strong>, <strong><code>ctod</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Vocab class for most EHR datatypes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocab.create" class="doc_header"><code>EhrVocab.create</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocab.create</code>(<strong><code>codes_df</code></strong>)</p>
</blockquote>
<p>Create vocab object (itoc, ctoi and maybe ctod) from the codes df</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocab.numericalize" class="doc_header"><code>EhrVocab.numericalize</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocab.numericalize</code>(<strong><code>codes</code></strong>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Lookup and return indices for codes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocab.textify" class="doc_header"><code>EhrVocab.textify</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocab.textify</code>(<strong><code>indxs</code></strong>)</p>
</blockquote>
<p>Lookup and return descriptions for codes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocab.get_emb_dims" class="doc_header"><code>EhrVocab.get_emb_dims</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocab.get_emb_dims</code>(<strong><code>αd</code></strong>=<em><code>0.5736</code></em>)</p>
</blockquote>
<p>Get embedding dimensions</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ObsVocab" class="doc_header"><code>class</code> <code>ObsVocab</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ObsVocab</code>(<strong><code>vocab_df</code></strong>) :: <a href="/lemonade/preprocessing_vocab.html#EhrVocab"><code>EhrVocab</code></a></p>
</blockquote>
<p>Special Vocab class for Observation codes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ObsVocab.create" class="doc_header"><code>ObsVocab.create</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ObsVocab.create</code>(<strong><code>obs_codes</code></strong>, <strong><code>num_buckets</code></strong>=<em><code>5</code></em>)</p>
</blockquote>
<p>Create vocab object from observation codes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ObsVocab.numericalize" class="doc_header"><code>ObsVocab.numericalize</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L80" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ObsVocab.numericalize</code>(<strong><code>codes</code></strong>, <strong><code>verbose</code></strong>=<em><code>True</code></em>, <strong><code>log_dir</code></strong>=<em><code>'./log'</code></em>)</p>
</blockquote>
<p>Numericalize observation codes (return indices for codes)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ObsVocab.textify" class="doc_header"><code>ObsVocab.textify</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ObsVocab.textify</code>(<strong><code>indxs</code></strong>)</p>
</blockquote>
<p>Textify observation codes (returns codes and descriptions)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>numericalize()</code> Explanation</strong></p>
<ul>
<li>split incoming concated <code>code||value||units||type</code> string</li>
<li>get a result_df based on everything except value</li>
<li>then do an <code>argsort()</code> on the value column to determine closest value<ul>
<li>based on example given in <a href="https://pandas.pydata.org/docs/user_guide/cookbook.html#building-criteria">pandas docs - cookbook</a><ul>
<li><strong>cookbook example that uses <code>loc</code> doesnt work, instead <code>iloc</code> <a href="https://stackoverflow.com/questions/30112202/how-do-i-find-the-closest-values-in-a-pandas-series-to-an-input-number/53553226">works</a></strong></li>
</ul>
</li>
<li><code>argsort()</code> - <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.argsort.html#numpy.argsort">Returns the indices that would sort this array</a></li>
<li><code>[:1]</code> on that returns the one row with the closest match, index of that is what we want</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Note about logging numericalize errors</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_codes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>orig_code</th>
      <th>desc</th>
      <th>value</th>
      <th>units</th>
      <th>type</th>
    </tr>
    <tr>
      <th>indx</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8302-2</td>
      <td>Body Height</td>
      <td>48.8</td>
      <td>cm</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>1</th>
      <td>72514-3</td>
      <td>Pain severity - 0-10 verbal numeric rating [Sc...</td>
      <td>1.3</td>
      <td>{score}</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29463-7</td>
      <td>Body Weight</td>
      <td>3.4</td>
      <td>kg</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6690-2</td>
      <td>Leukocytes [#/volume] in Blood by Automated count</td>
      <td>5.2</td>
      <td>10*3/uL</td>
      <td>numeric</td>
    </tr>
    <tr>
      <th>4</th>
      <td>789-8</td>
      <td>Erythrocytes [#/volume] in Blood by Automated ...</td>
      <td>5.2</td>
      <td>10*6/uL</td>
      <td>numeric</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span> <span class="o">=</span> <span class="n">ObsVocab</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">obs_codes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;8302-2||200.3||cm||numeric&#39;</span><span class="p">,</span> \
                            <span class="s1">&#39;72514-3||4||</span><span class="si">{score}</span><span class="s1">||numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;33756-8||21.7||mm||numeric&#39;</span><span class="p">,</span><span class="s1">&#39;29463-7||181.8||kg||numeric&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[6, 9, 176, 16]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;blah-2||200.3||cm||numeric&#39;</span><span class="p">,</span> \
                            <span class="s1">&#39;72514-3||4||</span><span class="si">{score}</span><span class="s1">||numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;33756-8||21.7||mm||numeric&#39;</span><span class="p">,</span><span class="s1">&#39;29463-7||181.8||kg||numeric&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[1, 9, 176, 16]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;8302-2||158.45000000000002||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;72514-3||2.475||{score}||numeric&#39;,
  &#39;Pain severity - 0-10 verbal numeric rating [Score] - Reported&#39;),
 (&#39;10834-0||3.35||g/dL||numeric&#39;, &#39;Globulin&#39;),
 (&#39;29463-7||122.44999999999999||kg||numeric&#39;, &#39;Body Weight&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;32465-7||Normal size prostate||</span><span class="si">{nominal}</span><span class="s1">||text&#39;</span><span class="p">,</span><span class="s2">&quot;80271-0||Positive Murphy&#39;s Sign||xxxnan||text&quot;</span><span class="p">,</span>\
                          <span class="s1">&#39;xxnone&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[545, 549, 0]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">545</span><span class="p">,</span> <span class="mi">549</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;32465-7||Normal size prostate||{nominal}||text&#39;,
  &#39;Physical findings of Prostate&#39;),
 (&#34;80271-0||Positive Murphy&#39;s Sign||xxxnan||text&#34;,
  &#39;Physical findings of Abdomen by Palpation&#39;),
 (&#39;xxnone&#39;, &#39;Nothing recorded&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span><span class="s1">&#39;xxunk&#39;</span><span class="p">,</span><span class="s1">&#39;72166-2||Never smoker||xxxnan||text&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 497]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab_obj</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">497</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;xxnone&#39;, &#39;Nothing recorded&#39;),
 (&#39;xxunk||xxunk||xxunk||xxunk&#39;, &#39;Unknown&#39;),
 (&#39;8302-2||44.6||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;8302-2||82.55000000000001||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;72166-2||Never smoker||xxxnan||text&#39;, &#39;Tobacco smoking status NHIS&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="VocabList">VocabList<a class="anchor-link" href="#VocabList"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EhrVocabList" class="doc_header"><code>class</code> <code>EhrVocabList</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L146" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EhrVocabList</code>(<strong><code>demographics_vocabs</code></strong>, <strong><code>records_vocabs</code></strong>, <strong><code>age_mean</code></strong>, <strong><code>age_std</code></strong>, <strong><code>path</code></strong>)</p>
</blockquote>
<p>Class to create and hold all vocab objects for an entire dataset</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocabList.create" class="doc_header"><code>EhrVocabList.create</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L152" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocabList.create</code>(<strong><code>path</code></strong>, <strong><code>num_buckets</code></strong>=<em><code>5</code></em>)</p>
</blockquote>
<p>Read all code dfs from the dataset path and create all vocab objects</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocabList.save" class="doc_header"><code>EhrVocabList.save</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L180" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocabList.save</code>()</p>
</blockquote>
<p>Save vocablist (containing all vocab objects for the dataset)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EhrVocabList.load" class="doc_header"><code>EhrVocabList.load</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EhrVocabList.load</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Load previously created vocablist object (containing all vocab objects for the dataset)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab_list_1K</span> <span class="o">=</span> <span class="n">EhrVocabList</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab_list_1K</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Saved vocab lists to datasets/synthea/1K/processed
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vl_1K</span> <span class="o">=</span> <span class="n">EhrVocabList</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">)</span>
<span class="n">obs_vocab</span><span class="p">,</span> <span class="n">alg_vocab</span><span class="p">,</span> <span class="n">crpl_vocab</span><span class="p">,</span> <span class="n">med_vocab</span><span class="p">,</span> <span class="n">img_vocab</span><span class="p">,</span> <span class="n">proc_vocab</span><span class="p">,</span> <span class="n">cnd_vocab</span><span class="p">,</span> <span class="n">imm_vocab</span> <span class="o">=</span> <span class="n">vl_1K</span><span class="o">.</span><span class="n">records_vocabs</span>
<span class="n">bday</span><span class="p">,</span> <span class="n">bmonth</span><span class="p">,</span> <span class="n">byear</span><span class="p">,</span> <span class="n">marital</span><span class="p">,</span> <span class="n">race</span><span class="p">,</span> <span class="n">ethnicity</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">birthplace</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">zipcode</span>  <span class="o">=</span> <span class="n">vl_1K</span><span class="o">.</span><span class="n">demographics_vocabs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="records_vocabs"><code>records_vocabs</code><a class="anchor-link" href="#records_vocabs"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab</span><span class="o">.</span><span class="n">vocab_size</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>550</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">proc_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span><span class="s1">&#39;65200003&#39;</span><span class="p">,</span><span class="s1">&#39;428191000124101&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 36, 2]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span><span class="mi">344001</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 7]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">proc_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;65200003&#39;</span><span class="p">]),</span> <span class="n">proc_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="mi">65200003</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([36], [36])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_vocab</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;xxnone&#39;, &#39;Nothing recorded&#39;),
 (&#39;xxunk&#39;, &#39;Unknown&#39;),
 (&#39;51185008&#39;, {&#39;Chest&#39;, &#39;Thoracic structure (body structure)&#39;}),
 (&#39;12921003&#39;, {&#39;Pelvis&#39;}),
 (&#39;40983000&#39;, {&#39;Arm&#39;}),
 (&#39;8205005&#39;, {&#39;Wrist&#39;})]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span><span class="s1">&#39;xxunk&#39;</span><span class="p">,</span> <span class="mi">51299004</span><span class="p">,</span><span class="mi">51185008</span><span class="p">,</span><span class="mi">12921003</span><span class="p">])</span> <span class="c1">#0,1,6,2,3</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 6, 2, 3]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;xxnone&#39;, &#39;Nothing recorded&#39;),
 (&#39;xxunk||xxunk||xxunk||xxunk&#39;, &#39;Unknown&#39;),
 (&#39;8302-2||44.6||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;8302-2||82.55000000000001||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;8302-2||120.5||cm||numeric&#39;, &#39;Body Height&#39;),
 (&#39;8302-2||158.45000000000002||cm||numeric&#39;, &#39;Body Height&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">200</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;10834-0||3.35||g/dL||numeric&#39;, &#39;Globulin&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;8302-2||200.3||cm||numeric&#39;</span><span class="p">,</span> \
                            <span class="s1">&#39;72514-3||4||</span><span class="si">{score}</span><span class="s1">||numeric&#39;</span><span class="p">,</span> <span class="s1">&#39;10834-0||3.7||g/dL||numeric&#39;</span><span class="p">,</span><span class="s1">&#39;29463-7||181.8||kg||numeric&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[6, 9, 201, 16]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obs_vocab</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">450</span><span class="p">,</span><span class="mi">548</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;786-4||35.25||g/dL||numeric&#39;, &#39;MCHC [Mass/volume] by Automated count&#39;),
 (&#39;2093-3||266.275||mg/dL||numeric&#39;, &#39;Total Cholesterol&#39;),
 (&#39;6206-7||71.1||kU/L||numeric&#39;, &#39;Peanut IgE Ab in Serum&#39;),
 (&#39;20505-4||1.175||mg/dL||numeric&#39;,
  &#39;Bilirubin.total [Mass/volume] in Urine by Test strip&#39;),
 (&#39;2075-0||107.6||mmol/L||numeric&#39;, &#39;Chloride&#39;),
 (&#39;46288-7||Surgical biopsy result abnormal||{nominal}||text&#39;,
  &#39;US Guidance for biopsy of Prostate&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_vocab</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;xxnone&#39;, &#39;Nothing recorded&#39;),
 (&#39;xxunk&#39;, &#39;Unknown&#39;),
 (&#39;834061||START&#39;, {&#39;Penicillin V Potassium 250 MG Oral Tablet&#39;}),
 (&#39;282464||START&#39;, {&#39;Acetaminophen 160 MG Oral Tablet&#39;}),
 (&#39;313782||START&#39;, {&#39;Acetaminophen 325 MG Oral Tablet&#39;})]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_vocab</span><span class="o">.</span><span class="n">itoc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;xxnone&#39;, &#39;xxunk&#39;, &#39;834061||START&#39;, &#39;282464||START&#39;, &#39;313782||START&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span> <span class="s1">&#39;xxunk&#39;</span><span class="p">,</span> <span class="s1">&#39;834061||START&#39;</span><span class="p">,</span><span class="s1">&#39;282464||START&#39;</span><span class="p">,</span> <span class="s1">&#39;313782||START&#39;</span><span class="p">,</span> <span class="s1">&#39;749882||START&#39;</span><span class="p">])</span> <span class="c1">#0,1,2,3,4,5</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 2, 3, 4, 5]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">med_vocab</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;834061||START&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[2]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="demographics_vocabs"><code>demographics_vocabs</code><a class="anchor-link" href="#demographics_vocabs"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">vocab</span> <span class="ow">in</span> <span class="n">vl_1K</span><span class="o">.</span><span class="n">demographics_vocabs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">vocab</span><span class="o">.</span><span class="n">get_emb_dims</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(33, 8)
(14, 7)
(124, 11)
(5, 5)
(7, 6)
(25, 8)
(4, 5)
(205, 13)
(211, 13)
(3, 5)
(200, 13)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bday</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;xxnone&#39;</span><span class="p">,</span><span class="s1">&#39;xxunk&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">31</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 2, 11, 32]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bday</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;xxnone&#39;, &#39;xxunk&#39;, &#39;1&#39;, &#39;10&#39;, &#39;31&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bmonth</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">13</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;12&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">byear</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="s1">&#39;1942&#39;</span><span class="p">,</span><span class="mi">1947</span><span class="p">,])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[44, 49]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">byear</span><span class="o">.</span><span class="n">numericalize</span><span class="p">([</span><span class="mi">1948</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[50]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">marital</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;xxnone&#39;, &#39;xxunk&#39;, &#39;M&#39;, &#39;S&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">race</span><span class="o">.</span><span class="n">textify</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;xxnone&#39;, &#39;xxunk&#39;, &#39;white&#39;, &#39;asian&#39;, &#39;black&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vl_1K</span><span class="o">.</span><span class="n">age_mean</span><span class="p">,</span> <span class="n">vl_1K</span><span class="o">.</span><span class="n">age_std</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(15885.602409638554, 9388.271666254166)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-All-Embedding-Dimensions">Get All Embedding Dimensions<a class="anchor-link" href="#Get-All-Embedding-Dimensions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_all_emb_dims" class="doc_header"><code>get_all_emb_dims</code><a href="https://github.com/corazonlabs/lemonade/tree/master/lemonade/preprocessing/vocab.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_all_emb_dims</code>(<strong><code>EhrVocabList</code></strong>, <strong><code>αd</code></strong>=<em><code>0.5736</code></em>)</p>
</blockquote>
<p>Get embedding dimensions for all vocab objects of the dataset</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims</span><span class="p">,</span> <span class="n">recs_dims</span><span class="p">,</span> <span class="n">demographics_dims_width</span><span class="p">,</span> <span class="n">recs_dims_width</span> <span class="o">=</span> <span class="n">get_all_emb_dims</span><span class="p">(</span><span class="n">EhrVocabList</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(33, 8),
 (14, 7),
 (124, 11),
 (5, 5),
 (7, 6),
 (25, 8),
 (4, 5),
 (205, 13),
 (211, 13),
 (3, 5),
 (200, 13)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recs_dims</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(550, 17),
 (27, 8),
 (54, 9),
 (224, 13),
 (11, 6),
 (128, 12),
 (201, 13),
 (20, 7)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims_width</span><span class="p">,</span> <span class="n">recs_dims_width</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(94, 85)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims</span><span class="p">,</span> <span class="n">recs_dims</span><span class="p">,</span> <span class="n">demographics_dims_width</span><span class="p">,</span> <span class="n">recs_dims_width</span> <span class="o">=</span> <span class="n">get_all_emb_dims</span><span class="p">(</span><span class="n">EhrVocabList</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH_1K</span><span class="p">),</span> <span class="n">αd</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(33, 144),
 (14, 116),
 (124, 200),
 (5, 90),
 (7, 98),
 (25, 134),
 (4, 85),
 (205, 227),
 (211, 229),
 (3, 79),
 (200, 226)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recs_dims</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(550, 291),
 (27, 137),
 (54, 163),
 (224, 232),
 (11, 109),
 (128, 202),
 (201, 226),
 (20, 127)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">demographics_dims_width</span><span class="p">,</span> <span class="n">recs_dims_width</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1628, 1487)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

