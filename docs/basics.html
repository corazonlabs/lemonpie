---

title: Basics


keywords: fastai
sidebar: home_sidebar

summary: "Setup GPU, default paths & global variables."
description: "Setup GPU, default paths & global variables."
nb_path: "00_basics.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_basics.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Every file in the library imports this, so all global set up required everywhere can be added here.</p>
<ol>
<li>Sets up device to GPU if available.</li>
<li>Defines default paths for different stores - so that they are out of version control by default.</li>
<li>Global scope variables - for convenience in other modules.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="GPU">GPU<a class="anchor-link" href="#GPU"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_device" class="doc_header"><code>get_device</code><a href="https://github.com/corazonlabs/lemonpie/tree/master/lemonpie/basics.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_device</code>()</p>
</blockquote>
<p>Checks to see if GPU is available and sets device to GPU or CPU</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_device</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Checks to see if GPU is available and sets device to GPU or CPU&#39;&#39;&#39;</span>
    <span class="n">use_cuda</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">enabled</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#Enable cuDNN auto-tuner - perf benefit for convs</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">device</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Settings-File">Settings File<a class="anchor-link" href="#Settings-File"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A YAML file called <a href="/lemonpie/basics.html#settings.yaml"><code>settings.yaml</code></a> is created (from a template) the first time the library is used.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="settings_template" class="doc_header"><code>settings_template</code><a href="https://github.com/corazonlabs/lemonpie/tree/master/lemonpie/basics.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>settings_template</code>()</p>
</blockquote>
<p>Create initial settings for library</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_settings" class="doc_header"><code>read_settings</code><a href="https://github.com/corazonlabs/lemonpie/tree/master/lemonpie/basics.py#L59" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_settings</code>()</p>
</blockquote>
<p>Read settings file at "~/.lemonpie/settings.yaml", if doesnt exist, create it from template</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Global-Scope-Variables">Global Scope Variables<a class="anchor-link" href="#Global-Scope-Variables"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DEVICE</span> <span class="o">=</span> <span class="n">get_device</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">read_settings</span><span class="p">()</span>

<span class="n">DATA_STORE</span>         <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STORES</span><span class="o">.</span><span class="n">DATA_STORE</span>
<span class="n">LOG_STORE</span>          <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STORES</span><span class="o">.</span><span class="n">LOG_STORE</span>
<span class="n">MODEL_STORE</span>        <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STORES</span><span class="o">.</span><span class="n">MODEL_STORE</span>
<span class="n">EXPERIMENT_STORE</span>   <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STORES</span><span class="o">.</span><span class="n">EXPERIMENT_STORE</span>

<span class="n">PATH_1K</span>   <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_STORE</span><span class="si">}</span><span class="s1">/synthea/1K&#39;</span>
<span class="n">PATH_10K</span>  <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_STORE</span><span class="si">}</span><span class="s1">/synthea/10K&#39;</span>
<span class="n">PATH_20K</span>  <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_STORE</span><span class="si">}</span><span class="s1">/synthea/20K&#39;</span>
<span class="n">PATH_100K</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_STORE</span><span class="si">}</span><span class="s1">/synthea/100K&#39;</span>

<span class="n">FILENAMES</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">FILENAMES</span>

<span class="n">SYNTHEA_DATAGEN_DATES</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SYNTHEA_DATAGEN_DATES</span>

<span class="n">CONDITIONS</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">CONDITIONS</span>

<span class="n">LOG_NUMERICALIZE_EXCEP</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOG_NUMERICALIZE_EXCEP</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>No settings file found, so creating from template ..
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>These global variables are used for convenience in many places in the library. They can be over-ridden by passing in different values.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CONDITIONS</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;diabetes&#39;: &#39;44054006||START&#39;,
 &#39;stroke&#39;: &#39;230690007||START&#39;,
 &#39;alzheimers&#39;: &#39;26929004||START&#39;,
 &#39;coronary_heart&#39;: &#39;53741008||START&#39;,
 &#39;lung_cancer&#39;: &#39;254637007||START&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>These <a href="/lemonpie/basics.html#CONDITIONS"><code>CONDITIONS</code></a> are eventually transformed into <strong>labels</strong> that we will use to train the the deep learning models.<ul>
<li>The <a href="/lemonpie/basics.html#CONDITIONS"><code>CONDITIONS</code></a> dict is used in pre-processing to identify &amp; label patients with these conditions. </li>
<li>The final labels the models train on must be a sub-set of these. </li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">FILENAMES</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;patients&#39;,
 &#39;observations&#39;,
 &#39;allergies&#39;,
 &#39;careplans&#39;,
 &#39;medications&#39;,
 &#39;imaging_studies&#39;,
 &#39;procedures&#39;,
 &#39;conditions&#39;,
 &#39;immunizations&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/lemonpie/basics.html#FILENAMES"><code>FILENAMES</code></a> is the list of files in the dataset that this library current runs pre-processing on.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>The following 2 global variables need to be changed in the <code>~/.lemonpie/settings.yaml</code> file based on your specific needs</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Change-SYNTHEA_DATAGEN_DATES">Change <a href="/lemonpie/basics.html#SYNTHEA_DATAGEN_DATES"><code>SYNTHEA_DATAGEN_DATES</code></a><a class="anchor-link" href="#Change-SYNTHEA_DATAGEN_DATES"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SYNTHEA_DATAGEN_DATES</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;1K&#39;: &#39;30-03-2021&#39;,
 &#39;10K&#39;: &#39;30-03-2021&#39;,
 &#39;20K&#39;: &#39;30-03-2021&#39;,
 &#39;100K&#39;: &#39;30-03-2021&#39;,
 &#39;250K&#39;: &#39;30-03-2021&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>A few sample entries are provided to serve as examples and all dates are set to the first time the library was run.</li>
<li>Please update these based on when you generate a particular dataset.</li>
<li>These dates are important to calculate patient age.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Change---Default-STORE-Paths">Change - Default STORE Paths<a class="anchor-link" href="#Change---Default-STORE-Paths"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATA_STORE</span><span class="p">,</span> <span class="n">MODEL_STORE</span><span class="p">,</span> <span class="n">EXPERIMENT_STORE</span><span class="p">,</span> <span class="n">LOG_STORE</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;/home/vinod/.lemonpie/datasets&#39;,
 &#39;/home/vinod/.lemonpie/models&#39;,
 &#39;/home/vinod/.lemonpie/experiments&#39;,
 &#39;/home/vinod/.lemonpie/logs&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Please change these paths to defaults in your specific configuration</strong></p>
<ul>
<li>All of these artifacts need to be in some form of failsafe storage, but not all need to be in version control.</li>
<li>Also, some of them are likely to get big and version control might not be the ideal location (e.g. data, logs and models).<ul>
<li>Experiments on the other hand, as designed here, tend to be small-sized enough and can be stored in github or some other version control system (VCS).</li>
<li>Each Experiment will keep track of the model it runs and saves it separately in the model store.</li>
<li>Given the nature of the dataset in this release of the library (synthetic / Synthea), it can be easily re-generated in case of a loss.</li>
</ul>
</li>
</ul>
<p>So, its left to the user to decide which store needs to be where, depending upon your decision, change the default paths here.<br>
<strong>Recommendation</strong> is to store experiments in some VCS and data &amp; models in some type of failsafe storage; logs are used minimally and not that important (atleast in this release).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup-Synthea">Setup Synthea<a class="anchor-link" href="#Setup-Synthea"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Set up Synthea so you can generate different types of synthetic EHR data per your need.<br>
<a href="https://github.com/synthetichealth/synthea/wiki">Synthea - Wiki</a> has details about the project and how to get started and generate the data.<br></p>
<p>Here are condensed instructions for <a href="https://github.com/synthetichealth/synthea/wiki/Basic-Setup-and-Running">basic setup of Synthea</a> for getting you up and running quickly. They also have an option for a developer setup, instructions for which are on the same webpage.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download-Synthea">Download Synthea<a class="anchor-link" href="#Download-Synthea"> </a></h3><ul>
<li>Download the binary (from the basic setup link above) to a local directory<ul>
<li>Don't run it yet</li>
</ul>
</li>
<li>Create a file in the same directory called <code>synthea.properties</code> and add the following lines into it and save it
<pre><code>exporter.years_of_history = 0
exporter.fhir.export = false
exporter.fhir.transaction_bundle = false
exporter.hospital.fhir.export = false
exporter.practitioner.fhir.export = false
exporter.csv.export = true</code></pre>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Generate-Data">Generate Data<a class="anchor-link" href="#Generate-Data"> </a></h3><ul>
<li>Once Synthea is set up, the following script will generate the data. </li>
<li>Its important to record the run dates (data generation dates each time you generate a new dataset with Synthea) as mentioned above, we will need this during preprocessing.<ul>
<li>Basic setup run command is: <code>java -jar synthea-with-dependencies.jar</code> </li>
<li>Developer setup run command is: <code>./run_synthea</code> </li>
</ul>
</li>
<li>Run with the <code>-p</code> switch to control population of patients generated as shown in examples below. </li>
</ul>
<p><strong>For example to generate 10,000 patients ..</strong></p>
<p><code>java -jar synthea-with-dependencies.jar -c synthea.properties -s 12345 -p 10000</code></p>
<ul>
<li>run date: 03/16/2021</li>
<li>Records: total=11833, alive=10000, dead=1833</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Copy-Into-DataStore">Copy Into DataStore<a class="anchor-link" href="#Copy-Into-DataStore"> </a></h3><ul>
<li>Synthea will save the generated dataset into the <code>output</code> directory in the same location (for basic setup).</li>
<li>Copy the <code>csv</code> directory to the location pointed to by the <code>DATASTORE</code> global variable<ul>
<li>for example <code>~/.lemonpie/datasets</code></li>
</ul>
</li>
<li>Rename the <code>csv</code> directory to <code>raw_original</code>, make sure the directory structure looks like this ..<ul>
<li>for 10K data - <code>~/.lemonpie/dataset/synthea/10K/raw_original</code></li>
<li><strong>Note</strong> - Synthea outputs all csv files in a folder called <code>csv</code>; after copying into the datastore, the csv files must be in the <code>raw_original</code> folder, where this library expects it for preprocessing.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-settings.yaml">Update <a href="/lemonpie/basics.html#settings.yaml"><code>settings.yaml</code></a><a class="anchor-link" href="#Update-settings.yaml"> </a></h3><ul>
<li>Go to your lemonpie settings file (~/.lemonpie/settings.yaml) and add an entry (or update the entry) for the dataset you just generated</li>
<li>For example for 10K data<ul>
<li>Under <a href="/lemonpie/basics.html#SYNTHEA_DATAGEN_DATES"><code>SYNTHEA_DATAGEN_DATES</code></a> create the following</li>
<li><code>'10K': '12-19-2020'</code></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
</div>
 

